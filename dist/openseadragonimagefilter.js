!function(){"use strict";function t(t,r){r=r||{};var o=r.filters;t.filters=o?i.isArray(o)?o:[o]:[];for(var a=0;a<t.filters.length;a++){var u=t.filters[a];if(!u.processors)throw new Error("Filter processors must be specified.");u.processors=i.isArray(u.processors)?u.processors:[u.processors]}if(t.filterIncrement++,"sync"===r.loadMode)t.viewer.forceRedraw();else{for(var s=[],a=0;a<t.filters.length;a++){var u=t.filters[a];if(!u.items){s=n(t.viewer.world);break}if(i.isArray(u.items))for(var c=0;c<u.items.length;c++)e(u.items[c],s);else e(u.items,s)}for(var a=0;a<s.length;a++)s[a].reset()}}function e(t,e){if(e.indexOf(t)>=0)throw new Error("An item can not have filters assigned multiple times.");e.push(t)}function n(t){for(var e=[],n=0;n<t.getItemCount();n++)e.push(t.getItemAt(n));return e}function r(t,e){if(0===t.filters.length)return[];for(var n=null,r=0;r<t.filters.length;r++){var o=t.filters[r];if(o.items){if(o.items===e||i.isArray(o.items)&&o.items.indexOf(e)>=0)return o.processors}else n=o.processors}return n?n:[]}var i=window.OpenSeadragon;if(!i&&(i=require("openseadragon"),!i))throw new Error("OpenSeadragon is missing.");if(!i.version||i.version.major<2||2===i.version.major&&i.version.minor<1)throw new Error("Filtering plugin requires OpenSeadragon version >= 2.1");i.Viewer.prototype.setFilterOptions=function(e){this.filterPluginInstance?t(this.filterPluginInstance,e):(e=e||{},e.viewer=this,this.filterPluginInstance=new i.FilterPlugin(e))},i.FilterPlugin=function(e){function n(t){var e=r(a,t.tiledImage);if(0!==e.length){var n=t.tile,o=t.image;if(null!==o){var u=window.document.createElement("canvas");u.width=o.width,u.height=o.height;var s=u.getContext("2d");s.drawImage(o,0,0),n._renderedContext=s;var c=t.getCompletionCallback();i(s,e,c),n._filterIncrement=a.filterIncrement}}}function i(t,e,n){if(n){for(var r=a.filterIncrement,i=[],o=0;o<e.length-1;o++)!function(n){i[n]=function(){a.filterIncrement===r&&e[n+1](t,i[n+1])}}(o);i[e.length-1]=function(){a.filterIncrement===r&&n()},e[0](t,i[0])}else for(var o=0;o<e.length;o++)e[o](t,function(){})}function o(t){var e=t.tile,n=t.rendered;if(n._filterIncrement!==a.filterIncrement){var o=r(a,t.tiledImage);if(0===o.length)return n._originalImageData&&(n.putImageData(n._originalImageData,0,0),delete n._originalImageData),void(n._filterIncrement=a.filterIncrement);if(n._originalImageData?n.putImageData(n._originalImageData,0,0):n._originalImageData=n.getImageData(0,0,n.canvas.width,n.canvas.height),e._renderedContext){if(e._filterIncrement===a.filterIncrement){var u=e._renderedContext.getImageData(0,0,e._renderedContext.canvas.width,e._renderedContext.canvas.height);return n.putImageData(u,0,0),delete e._renderedContext,delete e._filterIncrement,void(n._filterIncrement=a.filterIncrement)}delete e._renderedContext,delete e._filterIncrement}i(n,o),n._filterIncrement=a.filterIncrement}}if(e=e||{},!e.viewer)throw new Error("A viewer must be specified.");var a=this;this.viewer=e.viewer,this.viewer.addHandler("tile-loaded",n),this.viewer.addHandler("tile-drawing",o),this.filterIncrement=0,t(this,e)},i.Filters={THRESHOLDING:function(t){if(0>t||t>255)throw new Error("Threshold must be between 0 and 255.");return function(e,n){for(var r=e.getImageData(0,0,e.canvas.width,e.canvas.height),i=r.data,o=0;o<i.length;o+=4){var a=i[o],u=i[o+1],s=i[o+2],c=(a+u+s)/3;i[o]=i[o+1]=i[o+2]=t>c?0:255}e.putImageData(r,0,0),n()}},BRIGHTNESS:function(t){if(-255>t||t>255)throw new Error("Brightness adjustment must be between -255 and 255.");return function(e,n){for(var r=e.getImageData(0,0,e.canvas.width,e.canvas.height),i=r.data,o=0;o<i.length;o+=4)i[o]+=t,i[o+1]+=t,i[o+2]+=t;e.putImageData(r,0,0),n()}},CONTRAST:function(t){if(0>t)throw new Error("Contrast adjustment must be positive.");return function(e,n){for(var r=e.getImageData(0,0,e.canvas.width,e.canvas.height),i=r.data,o=0;o<i.length;o+=4)i[o]*=t,i[o+1]*=t,i[o+2]*=t;e.putImageData(r,0,0),n()}},GAMMA:function(t){if(0>t)throw new Error("Gamma adjustment must be positive.");return function(e,n){for(var r=e.getImageData(0,0,e.canvas.width,e.canvas.height),i=r.data,o=0;o<i.length;o+=4)i[o]=255*Math.pow(i[o]/255,t),i[o+1]=255*Math.pow(i[o+1]/255,t),i[o+2]=255*Math.pow(i[o+2]/255,t);e.putImageData(r,0,0),n()}},GREYSCALE:function(){return function(t,e){for(var n=t.getImageData(0,0,t.canvas.width,t.canvas.height),r=n.data,i=0;i<r.length;i+=4){var o=(r[i]+r[i+1]+r[i+2])/3;r[i]=o,r[i+1]=o,r[i+2]=o}t.putImageData(n,0,0),e()}},INVERT:function(){return function(t,e){for(var n=t.getImageData(0,0,t.canvas.width,t.canvas.height),r=n.data,i=0;i<r.length;i+=4)r[i]=255-r[i],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2];t.putImageData(n,0,0),e()}},MORPHOLOGICAL_OPERATION:function(t,e){if(t%2===0)throw new Error("The kernel size must be an odd number.");var n=Math.floor(t/2);if(!e)throw new Error("A comparator must be defined.");return function(r,i){for(var o,a=r.canvas.width,u=r.canvas.height,s=r.getImageData(0,0,a,u),c=r.getImageData(0,0,a,u).data,h=0;u>h;h++)for(var l=0;a>l;l++){o=4*(h*a+l);for(var f=c[o],g=c[o+1],p=c[o+2],d=0;t>d;d++)for(var v=0;t>v;v++){var y=l+v-n,m=h+d-n;y>=0&&a>y&&m>=0&&u>m&&(o=4*(m*a+y),f=e(c[o],f),g=e(c[o+1],g),p=e(c[o+2],p))}s.data[o]=f,s.data[o+1]=g,s.data[o+2]=p}r.putImageData(s,0,0),i()}},CONVOLUTION:function(t){if(!i.isArray(t))throw new Error("The kernel must be an array.");var e=Math.sqrt(t.length);if((e+1)%2!==0)throw new Error("The kernel must be a square matrix with oddwidth and height.");var n=(e-1)/2;return function(r,i){for(var o,a=r.canvas.width,u=r.canvas.height,s=r.getImageData(0,0,a,u),c=r.getImageData(0,0,a,u).data,h=0;u>h;h++)for(var l=0;a>l;l++){for(var f=0,g=0,p=0,d=0;e>d;d++)for(var v=0;e>v;v++){var y=l+v-n,m=h+d-n;if(y>=0&&a>y&&m>=0&&u>m){o=4*(m*a+y);var b=t[d*e+v];f+=c[o]*b,g+=c[o+1]*b,p+=c[o+2]*b}}o=4*(h*a+l),s.data[o]=f,s.data[o+1]=g,s.data[o+2]=p}r.putImageData(s,0,0),i()}}}}(),function(){var t,e,n,r,i,o,a,u,s,c,h,l,f,g,p,d,v,y,m,b,_,w,x,I,D,R,S=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},A=[].slice,C={}.hasOwnProperty,k=function(t,e){return function(){return t.apply(e,arguments)}},j=function(t,e){function n(){this.constructor=t}for(var r in e)C.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};I=["extended","included"],d=function(){function t(){}return t["extends"]=function(t){var e,n,r;for(e in t)n=t[e],S.call(I,e)<0&&(this[e]=n);return null!=(r=t.extended)&&r.apply(this),this},t.includes=function(t){var e,n,r;for(e in t)n=t[e],S.call(I,e)<0&&(this.prototype[e]=n);return null!=(r=t.included)&&r.apply(this),this},t.delegate=function(){var t,e,n,r,i,o;for(t=1<=arguments.length?A.call(arguments,0):[],n=t.pop(),o=[],r=0,i=t.length;i>r;r++)e=t[r],o.push(this.prototype[e]=n.prototype[e]);return o},t.aliasFunction=function(t,e){var n=this;return this.prototype[t]=function(){var t;return t=1<=arguments.length?A.call(arguments,0):[],n.prototype[e].apply(n,t)}},t.aliasProperty=function(t,e){return Object.defineProperty(this.prototype,t,{get:function(){return this[e]},set:function(t){return this[e]=t}})},t.included=function(t){return t.call(this,this.prototype)},t}(),D=Array.prototype.slice,t=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},w=function(){function t(){}return t.uniqid=function(){var t;return t=0,{get:function(){return t++}}}(),t.extend=function(){var t,e,n,r,i,o,a;for(n=arguments[0],i=2<=arguments.length?A.call(arguments,1):[],e=n,o=0,a=i.length;a>o;o++){t=i[o];for(r in t)C.call(t,r)&&(e[r]=t[r])}return e},t.clampRGB=function(t){return 0>t?0:t>255?255:t},t.copyAttributes=function(t,e,n){var r,i,o,a,u,s;for(null==n&&(n={}),a=t.attributes,s=[],i=0,o=a.length;o>i;i++)r=a[i],null!=n.except&&(u=r.nodeName,S.call(n.except,u)>=0)||s.push(e.setAttribute(r.nodeName,r.nodeValue));return s},t.dataArray=function(t){return null==t&&(t=0),i.NodeJS||null!=window.Uint8Array?new Uint8Array(t):new Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(b=exports,a=require("canvas"),f=a.Image,c=require("fibers"),x=require("fs")):b=window,i=function(n){function r(){this.nodeFileReady=k(this.nodeFileReady,this);var t,n,i,o=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof r?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],r.NodeJS||(i=parseInt(r.getAttrId(t[0]),10),n="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(i)||!_.has(i))?(this.id=w.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new e(this),this.renderer=new m(this),this.domIsLoaded(function(){return o.parseArguments(t),o.setup()}),this):_.execute(i,n)):new r(arguments)}return j(r,n),r.version={release:"4.1.2",date:"7/27/2013"},r.DEBUG=!1,r.allowRevert=!0,r.crossOrigin="anonymous",r.remoteProxy="",r.proxyParam="camanProxyUrl",r.NodeJS="undefined"!=typeof exports&&null!==exports,r.autoload=!r.NodeJS,r.toString=function(){return"Version "+r.version.release+", Released "+r.version.date},r.getAttrId=function(e){return r.NodeJS?!0:("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},r.prototype.domIsLoaded=function(t){var e,n=this;return r.NodeJS?setTimeout(function(){return t.call(n)},0):"complete"===document.readyState?(p.debug("DOM initialized"),setTimeout(function(){return t.call(n)},0)):(e=function(){return"complete"===document.readyState?(p.debug("DOM initialized"),t.call(n)):void 0},document.addEventListener("readystatechange",e,!1))},r.prototype.parseArguments=function(t){var e,n,r,i;if(0===t.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){r=t[4],i=[];for(e in r)C.call(r,e)&&(n=r[e],i.push(this.options[e]=n));return i}}},r.prototype.setInitObject=function(e){if(r.NodeJS)return this.initObj=e,void(this.initType="node");if("object"==typeof e?this.initObj=e:this.initObj=t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},r.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},r.prototype.initNode=function(){return p.debug("Initializing for NodeJS"),"string"==typeof this.initObj?x.readFile(this.initObj,this.nodeFileReady):this.nodeFileReady(null,this.initObj)},r.prototype.nodeFileReady=function(t,e){if(t)throw t;return this.image=new f,this.image.src=e,p.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.canvas=new a(this.imageWidth(),this.imageHeight()),this.finishInit()},r.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),w.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},r.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},r.prototype.imageAdjustments=function(){return this.needsHiDPISwap()&&(p.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),l.isRemote(this.image)?(this.image.src=l.proxyUrl(this.image.src),p.debug("Remote image detected, using URL = "+this.image.src)):void 0},r.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},r.prototype.isImageLoaded=function(){return this.image.complete?null==this.image.naturalWidth||0!==this.image.naturalWidth:!1},r.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},r.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},r.prototype.imageLoaded=function(){return p.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},r.prototype.finishInit=function(){var t,e,n,i,o;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,r.allowRevert)for(this.initializedPixelData=w.dataArray(this.pixelData.length),this.originalPixelData=w.dataArray(this.pixelData.length),o=this.pixelData,t=n=0,i=o.length;i>n;t=++n)e=o[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},r.NodeJS||_.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},r.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},r.prototype.resetOriginalPixelData=function(){var t,e,n,i,o,a;if(!r.allowRevert)throw"Revert disabled";for(this.originalPixelData=w.dataArray(this.pixelData.length),o=this.pixelData,a=[],t=n=0,i=o.length;i>n;t=++n)e=o[t],a.push(this.originalPixelData[t]=e);return a},r.prototype.hasId=function(){return null!=r.getAttrId(this.canvas)},r.prototype.assignId=function(){return r.NodeJS||this.canvas.getAttribute("data-caman-id")?void 0:this.canvas.setAttribute("data-caman-id",this.id)},r.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},r.prototype.hiDPIAdjustments=function(){var t;if(!r.NodeJS&&this.needsHiDPISwap())return t=this.hiDPIRatio(),1!==t?(p.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=""+this.preScaledWidth+"px",this.canvas.style.height=""+this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},r.prototype.hiDPIRatio=function(){var t,e;return e=window.devicePixelRatio||1,t=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,e/t},r.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},r.prototype.needsHiDPISwap=function(){return this.hiDPIDisabled()||!this.hiDPICapable()?!1:null!==this.hiDPIReplacement()},r.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},r.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),r.NodeJS||e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},r.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),s.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},r.prototype.revert=function(t){var e,n,i,o,a;if(null==t&&(t=!0),!r.allowRevert)throw"Revert disabled";for(a=this.originalVisiblePixels(),e=i=0,o=a.length;o>i;e=++i)n=a[e],this.pixelData[e]=n;return t?this.context.putImageData(this.imageData,0,0):void 0},r.prototype.reset=function(){var t,e,n,r,i,o,a,u,s;for(t=document.createElement("canvas"),w.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,e=t.getContext("2d"),r=e.getImageData(0,0,t.width,t.height),o=r.data,s=this.initializedPixelData,n=a=0,u=s.length;u>a;n=++a)i=s[n],o[n]=i;return e.putImageData(r,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},r.prototype.originalVisiblePixels=function(){var t,e,n,i,o,a,u,s,c,h,l,f,g,p,d,y,m,b,_,w,x;if(!r.allowRevert)throw"Revert disabled";if(h=[],f=this.cropCoordinates.x,i=f+this.width,g=this.cropCoordinates.y,o=g+this.height,this.resized){for(t=document.createElement("canvas"),t.width=this.originalWidth,t.height=this.originalHeight,n=t.getContext("2d"),u=n.getImageData(0,0,t.width,t.height),c=u.data,b=this.originalPixelData,a=d=0,m=b.length;m>d;a=++d)s=b[a],c[a]=s;n.putImageData(u,0,0),l=document.createElement("canvas"),l.width=this.width,l.height=this.height,n=l.getContext("2d"),n.drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),c=n.getImageData(0,0,this.width,this.height).data,p=this.width}else c=this.originalPixelData,p=this.originalWidth;for(a=y=0,_=c.length;_>y;a=y+=4)e=v.locationToCoordinates(a,p),f<=(w=e.x)&&i>w&&g<=(x=e.y)&&o>x&&h.push(c[a],c[a+1],c[a+2],c[a+3]);return h},r.prototype.process=function(t,e){return this.renderer.add({type:h.Type.Single,name:t,processFn:e}),this},r.prototype.processKernel=function(t,e,n,r){var i,o,a;if(null==n&&(n=null),null==r&&(r=0),null==n)for(n=0,i=o=0,a=e.length;a>=0?a>o:o>a;i=a>=0?++o:--o)n+=e[i];return this.renderer.add({type:h.Type.Kernel,name:t,adjust:e,divisor:n,bias:r}),this},r.prototype.processPlugin=function(t,e){return this.renderer.add({type:h.Type.Plugin,plugin:t,args:e}),this},r.prototype.newLayer=function(t){var e;return e=new g(this),this.canvasQueue.push(e),this.renderer.add({type:h.Type.LayerDequeue}),t.call(e),this.renderer.add({type:h.Type.LayerFinished}),this},r.prototype.executeLayer=function(t){return this.pushContext(t)},r.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},r.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},r.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},r}(d),b.Caman=i,i.Analyze=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,n,r,i,o,a;for(e={r:{},g:{},b:{}},t=r=0;255>=r;t=++r)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=i=0,a=this.c.pixelData.length;a>i;t=i+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(n=this.c.pixelData.length/4,t=o=0;255>=o;t=++o)e.r[t]/=n,e.g[t]/=n,e.b[t]/=n;return e},t}(),e=i.Analyze,i.DOMUpdated=function(){var t,e,n,r,i,a;if(e=document.querySelectorAll("img[data-caman]"),e.length>0){for(a=[],r=0,i=e.length;i>r;r++)t=e[r],a.push(n=new o(t,function(){return this.parse(),this.execute()}));return a}},i.autoload&&!function(){return"complete"===document.readyState?i.DOMUpdated():document.addEventListener("DOMContentLoaded",i.DOMUpdated,!1)}(),o=function(){function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=i(t,e.bind(this))}var e;return e="(\\w+)\\((.*?)\\)",t.prototype.parse=function(){var t,n,r,i,o,a,u,s,c,h,l,f,g;if(this.ele=this.caman.canvas,s=new RegExp(e,"g"),c=this.dataStr.match(s),c.length>0){for(s=new RegExp(e),g=[],h=0,l=c.length;l>h;h++){o=c[h],f=o.match(s),u=f[0],r=f[1],t=f[2],a=new Function("return function() {        this."+r+"("+t+");      };");try{i=a(),g.push(i.call(this.caman))}catch(d){n=d,g.push(p.debug(n))}}return g}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),i.Blender=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,n){return this.blenders[t](e,n)},t}(),n=i.Blender,i.Calculate=function(){function t(){}return t.distance=function(t,e,n,r){return Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2))},t.randomRange=function(t,e,n){var r;return null==n&&(n=!1),r=t+Math.random()*(e-t),n?r.toFixed(n):Math.round(r)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,n,r,i,o){var a,u,s,c,h,l,f,g,p,d,v,y,m,b,_,w,x,I,D,R,S,A,C,k,j,O,M;for(_=t[0],D=t[1],w=e[0],R=e[1],x=n[0],S=n[1],I=r[0],A=r[1],f={},h=parseInt(3*(w-_),10),s=3*(x-w)-h,a=I-_-h-s,l=3*(R-D),c=3*(S-R)-l,u=A-D-l-c,d=C=0;1e3>C;d=++C)b=d/1e3,g=Math.round(a*Math.pow(b,3)+s*Math.pow(b,2)+h*b+_),p=Math.round(u*Math.pow(b,3)+c*Math.pow(b,2)+l*b+D),i&&i>p?p=i:o&&p>o&&(p=o),f[g]=p;if(f.length<r[0]+1)for(d=k=0,O=r[0];O>=0?O>=k:k>=O;d=O>=0?++k:--k)if(null==f[d]){for(y=[d-1,f[d-1]],v=j=d,M=r[0];M>=d?M>=j:j>=M;v=M>=d?++j:--j)if(null!=f[v]){m=[v,f[v]];break}f[d]=y[1]+(m[1]-y[1])/(m[0]-y[0])*(d-y[0])}return null==f[r[0]]&&(f[r[0]]=f[r[0]-1]),f},t}(),r=i.Calculate,i.Convert=function(){function t(){}return t.hexToRGB=function(t){var e,n,r;return"#"===t.charAt(0)&&(t=t.substr(1)),r=parseInt(t.substr(0,2),16),n=parseInt(t.substr(2,2),16),e=parseInt(t.substr(4,2),16),{r:r,g:n,b:e}},t.rgbToHSL=function(t,e,n){var r,i,o,a,u,s;return"object"==typeof t&&(e=t.g,n=t.b,t=t.r),t/=255,e/=255,n/=255,a=Math.max(t,e,n),u=Math.min(t,e,n),o=(a+u)/2,a===u?i=s=0:(r=a-u,s=o>.5?r/(2-a-u):r/(a+u),i=function(){switch(a){case t:return(e-n)/r+(n>e?6:0);case e:return(n-t)/r+2;case n:return(t-e)/r+4}}(),i/=6),{h:i,s:s,l:o}},t.hslToRGB=function(t,e,n){var r,i,o,a,u;return"object"==typeof t&&(e=t.s,n=t.l,t=t.h),0===e?u=i=r=n:(a=.5>n?n*(1+e):n+e-n*e,o=2*n-a,u=this.hueToRGB(o,a,t+1/3),i=this.hueToRGB(o,a,t),r=this.hueToRGB(o,a,t-1/3)),{r:255*u,g:255*i,b:255*r}},t.hueToRGB=function(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+(e-t)*(2/3-n)*6:t},t.rgbToHSV=function(t,e,n){var r,i,o,a,u,s;return t/=255,e/=255,n/=255,o=Math.max(t,e,n),a=Math.min(t,e,n),s=o,r=o-a,u=0===o?0:r/o,o===a?i=0:(i=function(){switch(o){case t:return(e-n)/r+(n>e?6:0);case e:return(n-t)/r+2;case n:return(t-e)/r+4}}(),i/=6),{h:i,s:u,v:s}},t.hsvToRGB=function(t,e,n){var r,i,o,a,u,s,c,h;switch(a=Math.floor(6*t),i=6*t-a,u=n*(1-e),s=n*(1-i*e),h=n*(1-(1-i)*e),a%6){case 0:c=n,o=h,r=u;break;case 1:c=s,o=n,r=u;break;case 2:c=u,o=n,r=h;break;case 3:c=u,o=s,r=n;break;case 4:c=h,o=u,r=n;break;case 5:c=n,o=u,r=s}return{r:Math.floor(255*c),g:Math.floor(255*o),b:Math.floor(255*r)}},t.rgbToXYZ=function(t,e,n){var r,i,o;return t/=255,e/=255,n/=255,t>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,r=.4124*t+.3576*e+.1805*n,i=.2126*t+.7152*e+.0722*n,o=.0193*t+.1192*e+.9505*n,{x:100*r,y:100*i,z:100*o}},t.xyzToRGB=function(t,e,n){var r,i,o;return t/=100,e/=100,n/=100,o=3.2406*t+-1.5372*e+-.4986*n,i=-.9689*t+1.8758*e+.0415*n,r=.0557*t+-.204*e+1.057*n,o>.0031308?o=1.055*Math.pow(o,.4166666667)-.055:o*=12.92,i>.0031308?i=1.055*Math.pow(i,.4166666667)-.055:i*=12.92,r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,{r:255*o,g:255*i,b:255*r}},t.xyzToLab=function(t,e,n){var r,i,o,a,u,s;return"object"==typeof t&&(e=t.y,n=t.z,t=t.x),a=95.047,u=100,s=108.883,t/=a,e/=u,n/=s,t=t>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345,n=n>.008856451679?Math.pow(n,.3333333333):7.787037037*n+.1379310345,o=116*e-16,r=500*(t-e),i=200*(e-n),{l:o,a:r,b:i}},t.labToXYZ=function(t,e,n){var r,i,o;return"object"==typeof t&&(e=t.a,n=t.b,t=t.l),i=(t+16)/116,r=i+e/500,o=i-n/200,r=r>.2068965517?r*r*r:.1284185493*(r-.1379310345),i=i>.2068965517?i*i*i:.1284185493*(i-.1379310345),o=o>.2068965517?o*o*o:.1284185493*(o-.1379310345),{x:95.047*r,y:100*i,z:108.883*o}},t.rgbToLab=function(t,e,n){var r;return"object"==typeof t&&(e=t.g,n=t.b,t=t.r),r=this.rgbToXYZ(t,e,n),this.xyzToLab(r)},t.labToRGB=function(t,e,n){},t}(),u=i.Convert,i.Event=function(){function t(){}return t.events={},t.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],t.trigger=function(t,e,n){var r,i,o,a,u;if(null==n&&(n=null),this.events[e]&&this.events[e].length){for(a=this.events[e],u=[],i=0,o=a.length;o>i;i++)r=a[i],null===r.target||t.id===r.target.id?u.push(r.fn.call(t,n)):u.push(void 0);return u}},t.listen=function(t,e,n){var r,i;return"string"==typeof t&&(i=t,r=e,t=null,e=i,n=r),S.call(this.types,e)<0?!1:(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:n}),!0)},t}(),s=i.Event,i.Filter=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return i.prototype[t]=e},t}(),h=i.Filter,i.IO=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null==t?!1:this.corsEnabled(t)?!1:this.isURLRemote(t.src)},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){var e;return e=t.match(this.domainRegex),e?e[1]!==document.domain:!1},t.remoteCheck=function(t){if(this.isURLRemote(t)){if(i.remoteProxy.length)return i.isURLRemote(i.remoteProxy)?void p.info("Cannot use a remote proxy for loading images."):this.proxyUrl(t);p.info("Attempting to load a remote image without a configured proxy. URL: "+t)}},t.proxyUrl=function(t){return""+i.remoteProxy+"?"+i.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return e={ruby:"rb",python:"py",perl:"pl",javascript:"js"},t=t.toLowerCase(),null!=e[t]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),i.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},i.prototype.browserSave=function(t){var e;return null==t&&(t="png"),t=t.toLowerCase(),e=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=e},i.prototype.nodeSave=function(t,e){var n,r;null==e&&(e=!0);try{if(r=x.statSync(t),r.isFile()&&!e)return!1}catch(i){n=i,p.debug("Creating output file "+t)}return x.writeFile(t,this.canvas.toBuffer(),function(){return p.debug("Finished writing to "+t)})},i.prototype.toImage=function(t){var e;return e=document.createElement("img"),e.src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},i.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},l=i.IO,i.Layer=function(){function e(t){this.c=t,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=w.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},e.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},e.prototype.opacity=function(t){return this.options.opacity=t/100,this},e.prototype.copyParent=function(){var t,e,n,r;for(e=this.c.pixelData,t=n=0,r=this.c.pixelData.length;r>n;t=n+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:h.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var t,e,r,i,o,a,u,s,c;for(r=this.c.pixelStack[this.c.pixelStack.length-1],e=this.c.pixelData,c=[],t=u=0,s=e.length;s>u;t=u+=4)a={r:r[t],g:r[t+1],b:r[t+2],a:r[t+3]},o={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},i=n.execute(this.options.blendingMode,o,a),i.r=w.clampRGB(i.r),i.g=w.clampRGB(i.g),i.b=w.clampRGB(i.b),null==i.a&&(i.a=o.a),r[t]=a.r-(a.r-i.r)*(this.options.opacity*(i.a/255)),r[t+1]=a.g-(a.g-i.g)*(this.options.opacity*(i.a/255)),c.push(r[t+2]=a.b-(a.b-i.b)*(this.options.opacity*(i.a/255)));return c},e}(),g=i.Layer,i.Logger=function(){function t(){var t,e,n,r;for(r=["log","info","warn","error"],e=0,n=r.length;n>e;e++)t=r[e],this[t]=function(t){return function(){var e,n;if(e=1<=arguments.length?A.call(arguments,0):[],i.DEBUG)try{return console[t].apply(console,e)}catch(r){return n=r,console[t](e)}}}(t);this.debug=this.log}return t}(),p=new i.Logger,i.Pixel=function(){function t(t,e,n,r,i){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=n?n:0,this.a=null!=r?r:255,this.c=null!=i?i:null,this.loc=0}return t.coordinatesToLocation=function(t,e,n){return 4*(e*n+t)},t.locationToCoordinates=function(t,e){var n,r;return r=Math.floor(t/(4*e)),n=t%(4*e)/4,{x:n,y:r}},t.prototype.setContext=function(t){return this.c=t},t.prototype.locationXY=function(){var t,e;if(null==this.c)throw"Requires a CamanJS context";return e=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),t=this.loc%(4*this.c.dimensions.width)/4,{x:t,y:e}},t.prototype.pixelAtLocation=function(e){if(null==this.c)throw"Requires a CamanJS context";return new t(this.c.pixelData[e],this.c.pixelData[e+1],this.c.pixelData[e+2],this.c.pixelData[e+3],this.c)},t.prototype.getPixelRelative=function(e,n){var r;if(null==this.c)throw"Requires a CamanJS context";return r=this.loc+4*this.c.dimensions.width*(-1*n)+4*e,r>this.c.pixelData.length||0>r?new t(0,0,0,255,this.c):this.pixelAtLocation(r)},t.prototype.putPixelRelative=function(t,e,n){var r;if(null==this.c)throw"Requires a CamanJS context";return r=this.loc+4*this.c.dimensions.width*(-1*e)+4*t,newLoc>this.c.pixelData.length||newLoc<0?void 0:(this.c.pixelData[newLoc]=n.r,this.c.pixelData[newLoc+1]=n.g,this.c.pixelData[newLoc+2]=n.b,this.c.pixelData[newLoc+3]=n.a,!0)},t.prototype.getPixel=function(t,e){var n;if(null==this.c)throw"Requires a CamanJS context";return n=this.coordinatesToLocation(t,e,this.width),this.pixelAtLocation(n)},t.prototype.putPixel=function(t,e,n){var r;if(null==this.c)throw"Requires a CamanJS context";return r=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[r]=n.r,this.c.pixelData[r+1]=n.g,this.c.pixelData[r+2]=n.b,this.c.pixelData[r+3]=n.a},t.prototype.toString=function(){return this.toKey()},t.prototype.toHex=function(t){var e;return null==t&&(t=!1),e="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),t?e+this.a.toString(16):e},t}(),v=i.Pixel,i.Plugin=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,n){return this.plugins[e].apply(t,n)},t}(),y=i.Plugin,i.Renderer=function(){function t(t){this.c=t,this.processNext=k(this.processNext,this),this.renderQueue=[],this.modPixelData=null}return t.Blocks=i.NodeJS?require("os").cpus().length:4,t.prototype.add=function(t){return null!=t?this.renderQueue.push(t):void 0},t.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return s.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),
this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case h.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case h.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case h.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case h.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},t.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=w.dataArray(this.c.pixelData.length),this.processNext()},t.prototype.eachBlock=function(e){var n,r,o,a,u,s,h,l,f,g,p,d,v=this;for(this.blocksDone=0,l=this.c.pixelData.length,r=Math.floor(l/4/t.Blocks),n=4*r,h=n+l/4%t.Blocks*4,d=[],s=g=0,p=t.Blocks;p>=0?p>g:g>p;s=p>=0?++g:--g)f=s*n,a=f+(s===t.Blocks-1?h:n),i.NodeJS?(u=c(function(){return e.call(v,s,f,a)}),o=u.run(),d.push(this.blockFinished(o))):d.push(setTimeout(function(t,n,r){return function(){return e.call(v,t,n,r)}}(s,f,a),0));return d},t.prototype.executeFilter=function(){return s.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===h.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},t.prototype.executePlugin=function(){return p.debug("Executing plugin "+this.currentJob.plugin),y.execute(this.c,this.currentJob.plugin,this.currentJob.args),p.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},t.prototype.renderBlock=function(e,n,r){var o,a,u;for(p.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+n+", End: "+r),s.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:n,endPixel:r}),a=new v,a.setContext(this.c),o=u=n;r>u;o=u+=4)a.loc=o,a.r=this.c.pixelData[o],a.g=this.c.pixelData[o+1],a.b=this.c.pixelData[o+2],a.a=this.c.pixelData[o+3],this.currentJob.processFn(a),this.c.pixelData[o]=w.clampRGB(a.r),this.c.pixelData[o+1]=w.clampRGB(a.g),this.c.pixelData[o+2]=w.clampRGB(a.b),this.c.pixelData[o+3]=w.clampRGB(a.a);return i.NodeJS?c["yield"](e):this.blockFinished(e)},t.prototype.renderKernel=function(t,e,n){var r,o,a,u,s,h,l,f,g,d,y,m,b,_,x,I,D,R;for(m=this.currentJob.name,a=this.currentJob.bias,h=this.currentJob.divisor,y=this.c.pixelData.length,r=this.currentJob.adjust,o=Math.sqrt(r.length),d=[],p.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((o-1)/2)),n=Math.min(n,y-4*this.c.dimensions.width*((o-1)/2)),u=(o-1)/2,_=new v,_.setContext(this.c),l=I=e;n>I;l=I+=4){for(_.loc=l,s=0,f=D=-u;u>=-u?u>=D:D>=u;f=u>=-u?++D:--D)for(g=R=u;-u>=u?-u>=R:R>=-u;g=-u>=u?++R:--R)b=_.getPixelRelative(f,g),d[3*s]=b.r,d[3*s+1]=b.g,d[3*s+2]=b.b,s++;x=this.processKernel(r,d,h,a),this.modPixelData[l]=w.clampRGB(x.r),this.modPixelData[l+1]=w.clampRGB(x.g),this.modPixelData[l+2]=w.clampRGB(x.b),this.modPixelData[l+3]=this.c.pixelData[l+3]}return i.NodeJS?c["yield"](t):this.blockFinished(t)},t.prototype.blockFinished=function(e){var n,r,i;if(e>=0&&p.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,s.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===h.Type.Kernel)for(n=r=0,i=this.c.pixelData.length;i>=0?i>r:r>i;n=i>=0?++r:--r)this.c.pixelData[n]=this.modPixelData[n];return e>=0&&p.debug("Filter "+this.currentJob.name+" finished!"),s.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},t.prototype.processKernel=function(t,e,n,r){var i,o,a,u;for(o={r:0,g:0,b:0},i=a=0,u=t.length;u>=0?u>a:a>u;i=u>=0?++a:--a)o.r+=t[i]*e[3*i],o.g+=t[i]*e[3*i+1],o.b+=t[i]*e[3*i+2];return o.r=o.r/n+r,o.g=o.g/n+r,o.b=o.b/n+r,o},t.prototype.loadOverlay=function(t,e){var n,r,i=this;return n=document.createElement("img"),n.onload=function(){return t.context.drawImage(n,0,0,i.c.dimensions.width,i.c.dimensions.height),t.imageData=t.context.getImageData(0,0,i.c.dimensions.width,i.c.dimensions.height),t.pixelData=t.imageData.data,i.c.pixelData=t.pixelData,i.processNext()},r=l.remoteCheck(e),n.src=null!=r?r:e},t}(),m=i.Renderer,i.Store=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var n=this;return setTimeout(function(){return e.call(n.get(t),n.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),_=i.Store,n.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),n.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),n.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),n.register("overlay",function(t,e){var n;return n={},n.r=e.r>128?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,n.g=e.g>128?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,n.b=e.b>128?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,n}),n.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),n.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),n.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),n.register("softLight",function(t,e){var n;return n={},n.r=e.r>128?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,n.g=e.g>128?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,n.b=e.b>128?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,n}),n.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),n.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),h.register("fillColor",function(){var t;return t=1===arguments.length?u.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),h.register("brightness",function(t){return t=Math.floor(255*(t/100)),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),h.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var n;return n=Math.max(e.r,e.g,e.b),e.r!==n&&(e.r+=(n-e.r)*t),e.g!==n&&(e.g+=(n-e.g)*t),e.b!==n&&(e.b+=(n-e.b)*t),e})}),h.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var n,r,i;return i=Math.max(e.r,e.g,e.b),r=(e.r+e.g+e.b)/3,n=2*Math.abs(i-r)/255*t/100,e.r!==i&&(e.r+=(i-e.r)*n),e.g!==i&&(e.g+=(i-e.g)*n),e.b!==i&&(e.b+=(i-e.b)*n),e})}),h.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=r.luminance(t),t.r=e,t.g=e,t.b=e,t})}),h.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),h.register("hue",function(t){return this.process("hue",function(e){var n,r,i,o,a,s;return o=u.rgbToHSV(e.r,e.g,e.b),i=100*o.h,i+=Math.abs(t),i%=100,i/=100,o.h=i,s=u.hsvToRGB(o.h,o.s,o.v),a=s.r,r=s.g,n=s.b,e.r=a,e.g=r,e.b=n,e})}),h.register("colorize",function(){var t,e;return 2===arguments.length?(e=u.hexToRGB(arguments[0]),t=arguments[1]):4===arguments.length&&(e={r:arguments[0],g:arguments[1],b:arguments[2]},t=arguments[3]),this.process("colorize",function(n){return n.r-=(n.r-e.r)*(t/100),n.g-=(n.g-e.g)*(t/100),n.b-=(n.b-e.b)*(t/100),n})}),h.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),h.register("sepia",function(t){return null==t&&(t=100),t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+e.g*(.769*t)+e.b*(.189*t)),e.g=Math.min(255,e.r*(.349*t)+e.g*(1-.314*t)+e.b*(.168*t)),e.b=Math.min(255,e.r*(.272*t)+e.g*(.534*t)+e.b*(1-.869*t)),e})}),h.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),h.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var n;return n=r.randomRange(-1*t,t),e.r+=n,e.g+=n,e.b+=n,e})}),h.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),h.register("channels",function(t){var e,n;if("object"!=typeof t)return this;for(e in t)C.call(t,e)&&(n=t[e],0!==n?t[e]/=100:delete t[e]);return 0===t.length?this:this.process("channels",function(e){return null!=t.red&&(t.red>0?e.r+=(255-e.r)*t.red:e.r-=e.r*Math.abs(t.red)),null!=t.green&&(t.green>0?e.g+=(255-e.g)*t.green:e.g-=e.g*Math.abs(t.green)),null!=t.blue&&(t.blue>0?e.b+=(255-e.b)*t.blue:e.b-=e.b*Math.abs(t.blue)),e})}),h.register("curves",function(){var t,e,n,i,o,a,u,s,c,h,l,f;if(e=arguments[0],n=2<=arguments.length?A.call(arguments,1):[],"string"==typeof e&&(e=e.split("")),"v"===e[0]&&(e=["r","g","b"]),n.length<3||n.length>4)throw"Invalid number of arguments to curves filter";if(s=n[0],i=n[1],o=4===n.length?n[2]:n[1],a=n[n.length-1],t=r.bezier(s,i,o,a,0,255),s[0]>0)for(u=c=0,l=s[0];l>=0?l>c:c>l;u=l>=0?++c:--c)t[u]=s[1];if(a[0]<255)for(u=h=f=a[0];255>=f?255>=h:h>=255;u=255>=f?++h:--h)t[u]=a[1];return this.process("curves",function(n){var r,i;for(u=r=0,i=e.length;i>=0?i>r:r>i;u=i>=0?++r:--r)n[e[u]]=t[n[e[u]]];return n})}),h.register("exposure",function(t){var e,n,r;return r=Math.abs(t)/100,e=[0,255*r],n=[255-255*r,255],0>t&&(e=e.reverse(),n=n.reverse()),this.curves("rgb",[0,0],e,n,[255,255])}),i.Plugin.register("crop",function(t,e,n,r){var i,o;return null==n&&(n=0),null==r&&(r=0),"undefined"!=typeof exports&&null!==exports?i=new a(t,e):(i=document.createElement("canvas"),w.copyAttributes(this.canvas,i),i.width=t,i.height=e),o=i.getContext("2d"),o.drawImage(this.canvas,n,r,t,e,0,0,t,e),this.cropCoordinates={x:n,y:r},this.cropped=!0,this.replaceCanvas(i)}),i.Plugin.register("resize",function(t){var e,n;return null==t&&(t=null),null===t||null==t.width&&null==t.height?void p.error("Invalid or missing dimensions given for resize"):(null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new a(t.width,t.height):(e=document.createElement("canvas"),w.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),n=e.getContext("2d"),n.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e))}),i.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),i.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),i.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),i.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),i.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),i.Filter.register("motionBlur",function(t){var e;return e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:t>0&&90>t||t>180&&270>t?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),i.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),R={brightness:function(t,e,n){return t.r=t.r-t.r*e*n.strength,t.g=t.g-t.g*e*n.strength,t.b=t.b-t.b*e*n.strength,t},gamma:function(t,e,n){return t.r=255*Math.pow(t.r/255,Math.max(10*e*n.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*n.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*n.strength,1)),t},colorize:function(t,e,n){return t.r-=(t.r-n.color.r)*e,t.g-=(t.g-n.color.g)*e,t.b-=(t.b-n.color.b)*e,t}},h.register("vignette",function(t,e){var n,i,o,a;return null==e&&(e=60),"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,i=[this.dimensions.width/2,this.dimensions.height/2],a=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)),o=a-t,n=r.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(a){var u,s,c;return c=a.locationXY(),u=r.distance(c.x,c.y,i[0],i[1]),u>o&&(s=Math.max(1,n[Math.round((u-o)/t*100)]/10*e),a.r=255*Math.pow(a.r/255,s),a.g=255*Math.pow(a.g/255,s),a.b=255*Math.pow(a.b/255,s)),a})}),h.register("rectangularVignette",function(t){var e,n,o,a,s,c,h;if(e={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},t=w.extend(e,t),!t.size)return this;if("string"==typeof t.size)o=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*o,height:this.dimensions.height*o};else if("object"==typeof t.size)for(h=["width","height"],s=0,c=h.length;c>s;s++)n=h[s],"string"==typeof t.size[n]&&(t.size[n]=this.dimensions[n]*(parseInt(t.size[n],10)/100));else"number"===t.size&&(a=t.size,t.size={width:a,height:a});return"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=u.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=r.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var n,r,o;return r=e.locationXY(),r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.bottom&&r.y<t.coords.top?e:r.x>t.coords.left&&r.x<t.coords.right&&r.y>t.corners[3].y&&r.y<t.corners[2].y?e:(r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.top?n=(r.y-t.coords.top)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x>t.coords.right?n=(r.x-t.coords.right)/t.maxDist:r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y<t.coords.bottom?n=(t.coords.bottom-r.y)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x<t.coords.left?n=(t.coords.left-r.x)/t.maxDist:r.x<=t.corners[0].x&&r.y>=t.corners[0].y?(o=i.distance(r.x,r.y,t.corners[0].x,t.corners[0].y),n=(o-t.cornerRadius)/t.maxDist):r.x>=t.corners[1].x&&r.y>=t.corners[1].y?(o=i.distance(r.x,r.y,t.corners[1].x,t.corners[1].y),n=(o-t.cornerRadius)/t.maxDist):r.x>=t.corners[2].x&&r.y<=t.corners[2].y?(o=i.distance(r.x,r.y,t.corners[2].x,t.corners[2].y),n=(o-t.cornerRadius)/t.maxDist):r.x<=t.corners[3].x&&r.y<=t.corners[3].y&&(o=i.distance(r.x,r.y,t.corners[3].x,t.corners[3].y),n=(o-t.cornerRadius)/t.maxDist),0>n?e:R[t.method](e,n,t))})}),function(){var t,e,n,r,o;return r=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],e=function(t,e,n,r,i,o,u){var s,c,h,l,f,g,p;return s="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas"),s.width=t,s.height=e,l=n+Math.cos(i)*o*.5,g=r+Math.sin(i)*o*.5,f=n-Math.cos(i)*o*.5,p=r-Math.sin(i)*o*.5,c=s.getContext("2d"),h=c.createLinearGradient(l,g,f,p),u?(h.addColorStop(0,"white"),h.addColorStop(.5,"black"),h.addColorStop(1,"white")):(h.addColorStop(0,"white"),h.addColorStop(1,"black")),c.fillStyle=h,c.fillRect(0,0,t,e),c.getImageData(0,0,t,e)},n=function(t,e,n,r,i,o){var u,s,c;return u="undefined"!=typeof exports&&null!==exports?new a:document.createElement("canvas"),u.width=t,u.height=e,s=u.getContext("2d"),c=s.createRadialGradient(n,r,i,n,r,o),c.addColorStop(1,"white"),c.addColorStop(0,"black"),s.fillStyle=c,s.fillRect(0,0,t,e),s.getImageData(0,0,t,e)},t=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},i.Plugin.register("compoundBlur",function(e,n,i,a){var u,s,c,h,l,f,g,p,d,v,y,m,b,_,w,x,I,D,R,S,A,C,k,j,O,M,P,B,L,F,E,T,z,W,N,U,H,J,q,G,$,K,V,Z,Q,Y,X,tt,et,nt,rt,it,ot,at,ut,st,ct,ht;for(K=this.dimensions.width,v=this.dimensions.height,w=this.pixelData,B=e.data,G=K*v,$=G<<2,k=[],m=et=0;$>=0?$>et:et>$;m=$>=0?++et:--et)k[m]=w[m];for(l=0,H=a,a-=1;H-- >=0;)if(I=n+.5|0,0!==I){for(I>256&&(I=256),f=I+I+1,q=K<<2,V=K-1,y=v-1,L=I+1,J=L*(L+1)/2,U=new t,z=void 0,T=U,m=nt=1;f>=1?f>nt:nt>f;m=f>=1?++nt:--nt)T=T.next=new t,m===L&&(z=T);for(T.next=U,W=null,N=null,tt=Y=0,R=r[I],E=o[I],Q=rt=0;v>=0?v>rt:rt>v;Q=v>=0?++rt:--rt){for(O=g=u=P=d=c=0,M=L*(j=k[Y]),p=L*(C=k[Y+1]),s=L*(A=k[Y+2]),P+=J*j,d+=J*C,c+=J*A,T=U,m=it=0;L>=0?L>it:it>L;m=L>=0?++it:--it)T.r=j,T.g=C,T.b=A,T=T.next;for(m=ot=1;L>=1?L>ot:ot>L;m=L>=1?++ot:--ot)S=Y+((m>V?V:m)<<2),P+=(T.r=j=k[S])*(F=L-m),d+=(T.g=C=k[S+1])*F,c+=(T.b=A=k[S+2])*F,O+=j,g+=C,u+=A,T=T.next;for(W=U,N=z,Z=at=0;K>=0?K>at:at>K;Z=K>=0?++at:--at)k[Y]=P*R>>E,k[Y+1]=d*R>>E,k[Y+2]=c*R>>E,P-=M,d-=p,c-=s,M-=W.r,p-=W.g,s-=W.b,S=tt+((S=Z+L)<V?S:V)<<2,O+=W.r=k[S],g+=W.g=k[S+1],u+=W.b=k[S+2],P+=O,d+=g,c+=u,W=W.next,M+=j=N.r,p+=C=N.g,s+=A=N.b,O-=j,g-=C,u-=A,N=N.next,Y+=4;tt+=K}for(Z=ut=0;K>=0?K>ut:ut>K;Z=K>=0?++ut:--ut){for(g=u=O=d=c=P=0,Y=Z<<2,M=L*(j=k[Y]),p=L*(C=k[Y+1]),s=L*(A=k[Y+2]),P+=J*j,d+=J*C,c+=J*A,T=U,m=st=0;L>=0?L>st:st>L;m=L>=0?++st:--st)T.r=j,T.g=C,T.b=A,T=T.next;for(X=K,m=ct=1;L>=1?L>ct:ct>L;m=L>=1?++ct:--ct)Y=X+Z<<2,P+=(T.r=j=k[Y])*(F=L-m),d+=(T.g=C=k[Y+1])*F,c+=(T.b=A=k[Y+2])*F,O+=j,g+=C,u+=A,T=T.next,y>m&&(X+=K);for(Y=Z,W=U,N=z,Q=ht=0;v>=0?v>ht:ht>v;Q=v>=0?++ht:--ht)S=Y<<2,k[S]=P*R>>E,k[S+1]=d*R>>E,k[S+2]=c*R>>E,P-=M,d-=p,c-=s,M-=W.r,p-=W.g,s-=W.b,S=Z+((S=Q+L)<y?S:y)*K<<2,P+=O+=W.r=k[S],d+=g+=W.g=k[S+1],c+=u+=W.b=k[S+2],W=W.next,M+=j=N.r,p+=C=N.g,s+=A=N.b,O-=j,g-=C,u-=A,N=N.next,Y+=K}for(n*=i,m=G;--m>-1;)_=m<<2,D=(255&B[_+2])/255*a,x=0|D,x===l?(h=256*(D-(0|D)),b=256-h,w[_]=w[_]*b+k[_]*h>>8,w[_+1]=w[_+1]*b+k[_+1]*h>>8,w[_+2]=w[_+2]*b+k[_+2]*h>>8):x===l+1&&(w[_]=k[_],w[_+1]=k[_+1],w[_+2]=k[_+2]);l++}return this}),i.Filter.register("tiltShift",function(t){var n,r;return n={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},t=w.extend(n,t),t.angle*=Math.PI/180,r=e(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[r,t.startRadius,t.radiusFactor,t.steps])}),i.Filter.register("radialBlur",function(t){var e,r,i,o;return e={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},t=w.extend(e,t),t.radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),i=t.radius/2-t.size,o=t.radius/2,r=n(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,i,o),this.processPlugin("compoundBlur",[r,t.startRadius,t.radiusFactor,t.steps])})}(),i.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),i.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),i.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),i.Filter.register("posterize",function(t){var e,n;return e=256/t,n=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*n),t.g=Math.floor(Math.floor(t.g/e)*n),t.b=Math.floor(Math.floor(t.b/e)*n),t})}),i.Filter.register("vintage",function(t){return null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t?this.vignette("40%",30):void 0}),i.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),i.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),i.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),i.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),i.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),i.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),i.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),i.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),i.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),i.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),i.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),i.Filter.register("glowingSun",function(t){return null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t?this.vignette("45%",20):void 0}),i.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),i.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),i.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),i.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),i.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),i.Plugin.register("rotate",function(t){var e,n,r,i,o,u,s,c;return e=t%360,0===e?this.dimensions={width:this.canvas.width,height:this.canvas.height}:(o=Math.PI/180,"undefined"!=typeof exports&&null!==exports?n=new a:(n=document.createElement("canvas"),w.copyAttributes(this.canvas,n)),90===e||-270===e||270===e||-90===e?(u=this.canvas.height,i=this.canvas.width,s=u/2,c=i/2):180===e?(u=this.canvas.width,i=this.canvas.height,s=u/2,c=i/2):(u=Math.sqrt(Math.pow(this.originalWidth,2)+Math.pow(this.originalHeight,2)),i=u,s=this.canvas.height/2,c=this.canvas.width/2),n.width=u,n.height=i,r=n.getContext("2d"),r.save(),r.translate(s,c),r.rotate(e*o),r.drawImage(this.canvas,-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height),r.restore(),this.replaceCanvas(n))}),i.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))}),function(){var t,e,n;return e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],n=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],t=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},i.Plugin.register("stackBlur",function(r){var i,o,a,u,s,c,h,l,f,g,p,d,v,y,m,b,_,w,x,I,D,R,S,A,C,k,j,O,M,P,B,L,F,E,T,z,W,N,U,H,J,q,G,$,K;if(!(isNaN(r)||1>r)){for(r|=0,m=this.pixelData,P=this.dimensions.width,l=this.dimensions.height,u=r+r+1,M=P<<2,B=P-1,f=l-1,I=r+1,O=I*(I+1)/2,j=new t,S=j,g=W=1;u>=1?u>W:W>u;g=u>=1?++W:--W)S=S.next=new t,g===I&&(A=S);for(S.next=j,C=null,k=null,z=E=0,p=e[r],R=n[r],F=N=0;l>=0?l>N:N>l;F=l>=0?++N:--N){for(_=s=i=x=h=a=0,w=I*(b=m[E]),c=I*(y=m[E+1]),o=I*(v=m[E+2]),x+=O*b,h+=O*y,a+=O*v,S=j,g=U=0;I>=0?I>U:U>I;g=I>=0?++U:--U)S.r=b,S.g=y,S.b=v,S=S.next;for(g=H=1;I>=1?I>H:H>I;g=I>=1?++H:--H)d=E+((g>B?B:g)<<2),x+=(S.r=b=m[d])*(D=I-g),h+=(S.g=y=m[d+1])*D,a+=(S.b=v=m[d+2])*D,_+=b,s+=y,i+=v,S=S.next;for(C=j,k=A,L=J=0;P>=0?P>J:J>P;L=P>=0?++J:--J)m[E]=x*p>>R,m[E+1]=h*p>>R,m[E+2]=a*p>>R,x-=w,h-=c,a-=o,w-=C.r,c-=C.g,o-=C.b,d=z+((d=L+r+1)<B?d:B)<<2,_+=C.r=m[d],s+=C.g=m[d+1],i+=C.b=m[d+2],x+=_,h+=s,a+=i,C=C.next,w+=b=k.r,c+=y=k.g,o+=v=k.b,_-=b,s-=y,i-=v,k=k.next,E+=4;z+=P}for(L=q=0;P>=0?P>q:q>P;L=P>=0?++q:--q){for(s=i=_=h=a=x=0,E=L<<2,w=I*(b=m[E]),c=I*(y=m[E+1]),o=I*(v=m[E+2]),x+=O*b,h+=O*y,a+=O*v,S=j,g=G=0;I>=0?I>G:G>I;g=I>=0?++G:--G)S.r=b,S.g=y,S.b=v,S=S.next;for(T=P,g=$=1;r>=1?r>=$:$>=r;g=r>=1?++$:--$)E=T+L<<2,x+=(S.r=b=m[E])*(D=I-g),h+=(S.g=y=m[E+1])*D,a+=(S.b=v=m[E+2])*D,_+=b,s+=y,i+=v,S=S.next,f>g&&(T+=P);for(E=L,C=j,k=A,F=K=0;l>=0?l>K:K>l;F=l>=0?++K:--K)d=E<<2,m[d]=x*p>>R,m[d+1]=h*p>>R,m[d+2]=a*p>>R,x-=w,h-=c,a-=o,w-=C.r,c-=C.g,o-=C.b,d=L+((d=F+I)<f?d:f)*P<<2,x+=_+=C.r=m[d],h+=s+=C.g=m[d+1],a+=i+=C.b=m[d+2],C=C.next,w+=b=k.r,c+=y=k.g,o+=v=k.b,_-=b,s-=y,i-=v,k=k.next,E+=P}return this}}),i.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])})}(),i.Filter.register("threshold",function(t){return this.process("threshold",function(e){var n;return n=.2126*e.r+.7152*e.g+.0722*e.b,t>n?(e.r=0,e.g=0,e.b=0):(e.r=255,e.g=255,e.b=255),
e})})}.call(this),function(){function t(t,e){return t.set(e[0],e[1]),t}function e(t,e){return t.add(e),t}function n(t,e,n){var r=n.length;switch(r){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function r(t,e,n,r){for(var i=-1,o=t?t.length:0;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function i(t,e){for(var n=-1,r=t?t.length:0;++n<r&&e(t[n],n,t)!==!1;);return t}function o(t,e){for(var n=t?t.length:0;n--&&e(t[n],n,t)!==!1;);return t}function a(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(!e(t[n],n,t))return!1;return!0}function u(t,e){for(var n=-1,r=t?t.length:0,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function s(t,e){var n=t?t.length:0;return!!n&&y(t,e,0)>-1}function c(t,e,n){for(var r=-1,i=t?t.length:0;++r<i;)if(n(e,t[r]))return!0;return!1}function h(t,e){for(var n=-1,r=t?t.length:0,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function l(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function f(t,e,n,r){var i=-1,o=t?t.length:0;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function g(t,e,n,r){var i=t?t.length:0;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function p(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(e(t[n],n,t))return!0;return!1}function d(t,e,n){var r;return n(t,function(t,n,i){return e(t,n,i)?(r=n,!1):void 0}),r}function v(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function y(t,e,n){if(e!==e)return F(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function m(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function b(t,e){var n=t?t.length:0;return n?x(t,e)/n:wt}function _(t,e,n,r,i){return i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)}),n}function w(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function x(t,e){for(var n,r=-1,i=t.length;++r<i;){var o=e(t[r]);o!==$&&(n=n===$?o:n+o)}return n}function I(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function D(t,e){return h(e,function(e){return[e,t[e]]})}function R(t){return function(e){return t(e)}}function S(t,e){return h(e,function(e){return t[e]})}function A(t,e){return t.has(e)}function C(t,e){for(var n=-1,r=t.length;++n<r&&y(e,t[n],0)>-1;);return n}function k(t,e){for(var n=t.length;n--&&y(e,t[n],0)>-1;);return n}function j(t){return t&&t.Object===Object?t:null}function O(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&r++;return r}function M(t){return Dn[t]}function P(t){return Rn[t]}function B(t){return"\\"+An[t]}function L(t,e){return null==t?$:t[e]}function F(t,e,n){for(var r=t.length,i=e+(n?1:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function E(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}function T(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function z(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function W(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==Y||(t[n]=Y,o[i++]=n)}return o}function N(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function U(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function H(t){if(!t||!mn.test(t))return t.length;for(var e=vn.lastIndex=0;vn.test(t);)e++;return e}function J(t){return t.match(vn)}function q(t){return Sn[t]}function G(j){function je(t){if(mu(t)&&!vl(t)&&!(t instanceof Pe)){if(t instanceof Me)return t;if(kc.call(t,"__wrapped__"))return lo(t)}return new Me(t)}function Oe(){}function Me(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=$}function Pe(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=xt,this.__views__=[]}function Be(){var t=new Pe(this.__wrapped__);return t.__actions__=ni(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ni(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ni(this.__views__),t}function Le(){if(this.__filtered__){var t=new Pe(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Fe(){var t=this.__wrapped__.value(),e=this.__dir__,n=vl(t),r=0>e,i=n?t.length:0,o=Ui(0,i,this.__views__),a=o.start,u=o.end,s=u-a,c=r?u:a-1,h=this.__iteratees__,l=h.length,f=0,g=Xc(s,this.__takeCount__);if(!n||V>i||i==s&&g==s)return Er(t,this.__actions__);var p=[];t:for(;s--&&g>f;){c+=e;for(var d=-1,v=t[c];++d<l;){var y=h[d],m=y.iteratee,b=y.type,_=m(v);if(b==vt)v=_;else if(!_){if(b==dt)continue t;break t}}p[f++]=v}return p}function Ee(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Te(){this.__data__=hh?hh(null):{}}function ze(t){return this.has(t)&&delete this.__data__[t]}function We(t){var e=this.__data__;if(hh){var n=e[t];return n===Q?$:n}return kc.call(e,t)?e[t]:$}function Ne(t){var e=this.__data__;return hh?e[t]!==$:kc.call(e,t)}function Ue(t,e){var n=this.__data__;return n[t]=hh&&e===$?Q:e,this}function He(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Je(){this.__data__=[]}function qe(t){var e=this.__data__,n=vn(e,t);if(0>n)return!1;var r=e.length-1;return n==r?e.pop():Jc.call(e,n,1),!0}function Ge(t){var e=this.__data__,n=vn(e,t);return 0>n?$:e[n][1]}function $e(t){return vn(this.__data__,t)>-1}function Ke(t,e){var n=this.__data__,r=vn(n,t);return 0>r?n.push([t,e]):n[r][1]=e,this}function Ve(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ze(){this.__data__={hash:new Ee,map:new(ah||He),string:new Ee}}function Qe(t){return Fi(this,t)["delete"](t)}function Ye(t){return Fi(this,t).get(t)}function Xe(t){return Fi(this,t).has(t)}function tn(t,e){return Fi(this,t).set(t,e),this}function en(t){var e=-1,n=t?t.length:0;for(this.__data__=new Ve;++e<n;)this.add(t[e])}function nn(t){return this.__data__.set(t,Q),this}function rn(t){return this.__data__.has(t)}function on(t){this.__data__=new He(t)}function an(){this.__data__=new He}function un(t){return this.__data__["delete"](t)}function sn(t){return this.__data__.get(t)}function cn(t){return this.__data__.has(t)}function hn(t,e){var n=this.__data__;return n instanceof He&&n.__data__.length==V&&(n=this.__data__=new Ve(n.__data__)),n.set(t,e),this}function ln(t,e,n,r){return t===$||eu(t,Dc[n])&&!kc.call(r,n)?e:t}function fn(t,e,n){(n===$||eu(t[e],n))&&("number"!=typeof e||n!==$||e in t)||(t[e]=n)}function gn(t,e,n){var r=t[e];kc.call(t,e)&&eu(r,n)&&(n!==$||e in t)||(t[e]=n)}function vn(t,e){for(var n=t.length;n--;)if(eu(t[n][0],e))return n;return-1}function Dn(t,e,n,r){return xh(t,function(t,i,o){e(r,t,n(t),o)}),r}function Rn(t,e){return t&&ri(e,rs(e),t)}function Sn(t,e){for(var n=-1,r=null==t,i=e.length,o=Array(i);++n<i;)o[n]=r?$:ts(t,e[n]);return o}function An(t,e,n){return t===t&&(n!==$&&(t=n>=t?t:n),e!==$&&(t=t>=e?t:e)),t}function jn(t,e,n,r,o,a,u){var s;if(r&&(s=a?r(t,o,a,u):r(t)),s!==$)return s;if(!yu(t))return t;var c=vl(t);if(c){if(s=Ji(t),!e)return ni(t,s)}else{var h=Ni(t),l=h==jt||h==Ot;if(yl(t))return Jr(t,e);if(h==Bt||h==Rt||l&&!a){if(E(t))return a?t:{};if(s=qi(l?{}:t),!e)return ii(t,Rn(s,t))}else{if(!In[h])return a?t:{};s=Gi(t,h,jn,e)}}u||(u=new on);var f=u.get(t);if(f)return f;if(u.set(t,s),!c)var g=n?Oi(t):rs(t);return i(g||t,function(i,o){g&&(o=i,i=t[o]),gn(s,o,jn(i,e,n,r,o,t,u))}),s}function On(t){var e=rs(t),n=e.length;return function(r){if(null==r)return!n;for(var i=n;i--;){var o=e[i],a=t[o],u=r[o];if(u===$&&!(o in Object(r))||!a(u))return!1}return!0}}function Pn(t){return yu(t)?Uc(t):{}}function Bn(t,e,n){if("function"!=typeof t)throw new xc(Z);return qc(function(){t.apply($,n)},e)}function Ln(t,e,n,r){var i=-1,o=s,a=!0,u=t.length,l=[],f=e.length;if(!u)return l;n&&(e=h(e,R(n))),r?(o=c,a=!1):e.length>=V&&(o=A,a=!1,e=new en(e));t:for(;++i<u;){var g=t[i],p=n?n(g):g;if(g=r||0!==g?g:0,a&&p===p){for(var d=f;d--;)if(e[d]===p)continue t;l.push(g)}else o(e,p,r)||l.push(g)}return l}function Tn(t,e){var n=!0;return xh(t,function(t,r,i){return n=!!e(t,r,i)}),n}function zn(t,e,n){for(var r=-1,i=t.length;++r<i;){var o=t[r],a=e(o);if(null!=a&&(u===$?a===a&&!Mu(a):n(a,u)))var u=a,s=o}return s}function Wn(t,e,n,r){var i=t.length;for(n=zu(n),0>n&&(n=-n>i?0:i+n),r=r===$||r>i?i:zu(r),0>r&&(r+=i),r=n>r?0:Wu(r);r>n;)t[n++]=e;return t}function Nn(t,e){var n=[];return xh(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}function Un(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=Ki),i||(i=[]);++o<a;){var u=t[o];e>0&&n(u)?e>1?Un(u,e-1,n,r,i):l(i,u):r||(i[i.length]=u)}return i}function Hn(t,e){return t&&Dh(t,e,rs)}function Jn(t,e){return t&&Rh(t,e,rs)}function qn(t,e){return u(e,function(e){return pu(t[e])})}function Gn(t,e){e=Yi(e,t)?[e]:Ur(e);for(var n=0,r=e.length;null!=t&&r>n;)t=t[co(e[n++])];return n&&n==r?t:$}function $n(t,e,n){var r=e(t);return vl(t)?r:l(r,n(t))}function Kn(t,e){return t>e}function Vn(t,e){return null!=t&&(kc.call(t,e)||"object"==typeof t&&e in t&&null===zi(t))}function Zn(t,e){return null!=t&&e in Object(t)}function Qn(t,e,n){return t>=Xc(e,n)&&t<Yc(e,n)}function Yn(t,e,n){for(var r=n?c:s,i=t[0].length,o=t.length,a=o,u=Array(o),l=1/0,f=[];a--;){var g=t[a];a&&e&&(g=h(g,R(e))),l=Xc(g.length,l),u[a]=!n&&(e||i>=120&&g.length>=120)?new en(a&&g):$}g=t[0];var p=-1,d=u[0];t:for(;++p<i&&f.length<l;){var v=g[p],y=e?e(v):v;if(v=n||0!==v?v:0,!(d?A(d,y):r(f,y,n))){for(a=o;--a;){var m=u[a];if(!(m?A(m,y):r(t[a],y,n)))continue t}d&&d.push(y),f.push(v)}}return f}function Xn(t,e,n,r){return Hn(t,function(t,i,o){e(r,n(t),i,o)}),r}function tr(t,e,r){Yi(e,t)||(e=Ur(e),t=uo(t,e),e=Oo(e));var i=null==t?t:t[co(e)];return null==i?$:n(i,t,r)}function er(t,e,n,r,i){return t===e?!0:null==t||null==e||!yu(t)&&!mu(e)?t!==t&&e!==e:nr(t,e,er,n,r,i)}function nr(t,e,n,r,i,o){var a=vl(t),u=vl(e),s=St,c=St;a||(s=Ni(t),s=s==Rt?Bt:s),u||(c=Ni(e),c=c==Rt?Bt:c);var h=s==Bt&&!E(t),l=c==Bt&&!E(e),f=s==c;if(f&&!h)return o||(o=new on),a||Pu(t)?Ci(t,e,n,r,i,o):ki(t,e,s,n,r,i,o);if(!(i&ht)){var g=h&&kc.call(t,"__wrapped__"),p=l&&kc.call(e,"__wrapped__");if(g||p){var d=g?t.value():t,v=p?e.value():e;return o||(o=new on),n(d,v,r,i,o)}}return f?(o||(o=new on),ji(t,e,n,r,i,o)):!1}function rr(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var u=n[i];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++i<o;){u=n[i];var s=u[0],c=t[s],h=u[1];if(a&&u[2]){if(c===$&&!(s in t))return!1}else{var l=new on;if(r)var f=r(c,h,s,t,e,l);if(!(f===$?er(h,c,r,ct|ht,l):f))return!1}}return!0}function ir(t){if(!yu(t)||eo(t))return!1;var e=pu(t)||E(t)?Bc:De;return e.test(ho(t))}function or(t){return"function"==typeof t?t:null==t?Gs:"object"==typeof t?vl(t)?lr(t[0],t[1]):hr(t):tc(t)}function ar(t){return Qc(Object(t))}function ur(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}function sr(t,e){return e>t}function cr(t,e){var n=-1,r=iu(t)?Array(t.length):[];return xh(t,function(t,i,o){r[++n]=e(t,i,o)}),r}function hr(t){var e=Ei(t);return 1==e.length&&e[0][2]?io(e[0][0],e[0][1]):function(n){return n===t||rr(n,t,e)}}function lr(t,e){return Yi(t)&&ro(e)?io(co(t),e):function(n){var r=ts(n,t);return r===$&&r===e?ns(n,t):er(e,r,$,ct|ht)}}function fr(t,e,n,r,o){if(t!==e){if(!vl(e)&&!Pu(e))var a=is(e);i(a||e,function(i,u){if(a&&(u=i,i=e[u]),yu(i))o||(o=new on),gr(t,e,u,n,fr,r,o);else{var s=r?r(t[u],i,u+"",t,e,o):$;s===$&&(s=i),fn(t,u,s)}})}}function gr(t,e,n,r,i,o,a){var u=t[n],s=e[n],c=a.get(s);if(c)return void fn(t,n,c);var h=o?o(u,s,n+"",t,e,a):$,l=h===$;l&&(h=s,vl(s)||Pu(s)?vl(u)?h=u:ou(u)?h=ni(u):(l=!1,h=jn(s,!0)):Au(s)||nu(s)?nu(u)?h=Uu(u):!yu(u)||r&&pu(u)?(l=!1,h=jn(s,!0)):h=u:l=!1),a.set(s,h),l&&i(h,s,r,o,a),a["delete"](s),fn(t,n,h)}function pr(t,e){var n=t.length;if(n)return e+=0>e?n:0,Zi(e,n)?t[e]:$}function dr(t,e,n){var r=-1;e=h(e.length?e:[Gs],R(Li()));var i=cr(t,function(t,n,i){var o=h(e,function(e){return e(t)});return{criteria:o,index:++r,value:t}});return w(i,function(t,e){return Xr(t,e,n)})}function vr(t,e){return t=Object(t),f(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}function yr(t,e){for(var n=-1,r=Mi(t),i=r.length,o={};++n<i;){var a=r[n],u=t[a];e(u,a)&&(o[a]=u)}return o}function mr(t){return function(e){return null==e?$:e[t]}}function br(t){return function(e){return Gn(e,t)}}function _r(t,e,n,r){var i=r?m:y,o=-1,a=e.length,u=t;for(t===e&&(e=ni(e)),n&&(u=h(t,R(n)));++o<a;)for(var s=0,c=e[o],l=n?n(c):c;(s=i(u,l,s,r))>-1;)u!==t&&Jc.call(u,s,1),Jc.call(t,s,1);return t}function wr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;if(Zi(i))Jc.call(t,i,1);else if(Yi(i,t))delete t[co(i)];else{var a=Ur(i),u=uo(t,a);null!=u&&delete u[co(Oo(a))]}}}return t}function xr(t,e){return t+$c(eh()*(e-t+1))}function Ir(t,e,n,r){for(var i=-1,o=Yc(Gc((e-t)/(n||1)),0),a=Array(o);o--;)a[r?o:++i]=t,t+=n;return a}function Dr(t,e){var n="";if(!t||1>e||e>bt)return n;do e%2&&(n+=t),e=$c(e/2),e&&(t+=t);while(e);return n}function Rr(t,e,n,r){e=Yi(e,t)?[e]:Ur(e);for(var i=-1,o=e.length,a=o-1,u=t;null!=u&&++i<o;){var s=co(e[i]);if(yu(u)){var c=n;if(i!=a){var h=u[s];c=r?r(h,s,u):$,c===$&&(c=null==h?Zi(e[i+1])?[]:{}:h)}gn(u,s,c)}u=u[s]}return t}function Sr(t,e,n){var r=-1,i=t.length;0>e&&(e=-e>i?0:i+e),n=n>i?i:n,0>n&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function Ar(t,e){var n;return xh(t,function(t,r,i){return n=e(t,r,i),!n}),!!n}function Cr(t,e,n){var r=0,i=t?t.length:r;if("number"==typeof e&&e===e&&Dt>=i){for(;i>r;){var o=r+i>>>1,a=t[o];null!==a&&!Mu(a)&&(n?e>=a:e>a)?r=o+1:i=o}return i}return kr(t,e,Gs,n)}function kr(t,e,n,r){e=n(e);for(var i=0,o=t?t.length:0,a=e!==e,u=null===e,s=Mu(e),c=e===$;o>i;){var h=$c((i+o)/2),l=n(t[h]),f=l!==$,g=null===l,p=l===l,d=Mu(l);if(a)var v=r||p;else v=c?p&&(r||f):u?p&&f&&(r||!g):s?p&&f&&!g&&(r||!d):g||d?!1:r?e>=l:e>l;v?i=h+1:o=h}return Xc(o,It)}function jr(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],u=e?e(a):a;if(!n||!eu(u,s)){var s=u;o[i++]=0===a?0:a}}return o}function Or(t){return"number"==typeof t?t:Mu(t)?wt:+t}function Mr(t){if("string"==typeof t)return t;if(Mu(t))return wh?wh.call(t):"";var e=t+"";return"0"==e&&1/t==-mt?"-0":e}function Pr(t,e,n){var r=-1,i=s,o=t.length,a=!0,u=[],h=u;if(n)a=!1,i=c;else if(o>=V){var l=e?null:Ah(t);if(l)return N(l);a=!1,i=A,h=new en}else h=e?[]:u;t:for(;++r<o;){var f=t[r],g=e?e(f):f;if(f=n||0!==f?f:0,a&&g===g){for(var p=h.length;p--;)if(h[p]===g)continue t;e&&h.push(g),u.push(f)}else i(h,g,n)||(h!==u&&h.push(g),u.push(f))}return u}function Br(t,e){e=Yi(e,t)?[e]:Ur(e),t=uo(t,e);var n=co(Oo(e));return!(null!=t&&Vn(t,n))||delete t[n]}function Lr(t,e,n,r){return Rr(t,e,n(Gn(t,e)),r)}function Fr(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Sr(t,r?0:o,r?o+1:i):Sr(t,r?o+1:0,r?i:o)}function Er(t,e){var n=t;return n instanceof Pe&&(n=n.value()),f(e,function(t,e){return e.func.apply(e.thisArg,l([t],e.args))},n)}function Tr(t,e,n){for(var r=-1,i=t.length;++r<i;)var o=o?l(Ln(o,t[r],e,n),Ln(t[r],o,e,n)):t[r];return o&&o.length?Pr(o,e,n):[]}function zr(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var u=o>r?e[r]:$;n(a,t[r],u)}return a}function Wr(t){return ou(t)?t:[]}function Nr(t){return"function"==typeof t?t:Gs}function Ur(t){return vl(t)?t:Ph(t)}function Hr(t,e,n){var r=t.length;return n=n===$?r:n,!e&&n>=r?t:Sr(t,e,n)}function Jr(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}function qr(t){var e=new t.constructor(t.byteLength);return new Tc(e).set(new Tc(t)),e}function Gr(t,e){var n=e?qr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function $r(e,n,r){var i=n?r(z(e),!0):z(e);return f(i,t,new e.constructor)}function Kr(t){var e=new t.constructor(t.source,_e.exec(t));return e.lastIndex=t.lastIndex,e}function Vr(t,n,r){var i=n?r(N(t),!0):N(t);return f(i,e,new t.constructor)}function Zr(t){return _h?Object(_h.call(t)):{}}function Qr(t,e){var n=e?qr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Yr(t,e){if(t!==e){var n=t!==$,r=null===t,i=t===t,o=Mu(t),a=e!==$,u=null===e,s=e===e,c=Mu(e);if(!u&&!c&&!o&&t>e||o&&a&&s&&!u&&!c||r&&a&&s||!n&&s||!i)return 1;if(!r&&!o&&!c&&e>t||c&&n&&i&&!r&&!o||u&&n&&i||!a&&i||!s)return-1}return 0}function Xr(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,u=n.length;++r<a;){var s=Yr(i[r],o[r]);if(s){if(r>=u)return s;var c=n[r];return s*("desc"==c?-1:1)}}return t.index-e.index}function ti(t,e,n,r){for(var i=-1,o=t.length,a=n.length,u=-1,s=e.length,c=Yc(o-a,0),h=Array(s+c),l=!r;++u<s;)h[u]=e[u];for(;++i<a;)(l||o>i)&&(h[n[i]]=t[i]);for(;c--;)h[u++]=t[i++];return h}function ei(t,e,n,r){for(var i=-1,o=t.length,a=-1,u=n.length,s=-1,c=e.length,h=Yc(o-u,0),l=Array(h+c),f=!r;++i<h;)l[i]=t[i];for(var g=i;++s<c;)l[g+s]=e[s];for(;++a<u;)(f||o>i)&&(l[g+n[a]]=t[i++]);return l}function ni(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function ri(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var a=e[i],u=r?r(n[a],t[a],a,n,t):t[a];gn(n,a,u)}return n}function ii(t,e){return ri(t,Wi(t),e)}function oi(t,e){return function(n,i){var o=vl(n)?r:Dn,a=e?e():{};return o(n,t,Li(i),a)}}function ai(t){return qa(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:$,a=i>2?n[2]:$;for(o=t.length>3&&"function"==typeof o?(i--,o):$,a&&Qi(n[0],n[1],a)&&(o=3>i?$:o,i=1),e=Object(e);++r<i;){var u=n[r];u&&t(e,u,r,o)}return e})}function ui(t,e){return function(n,r){if(null==n)return n;if(!iu(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&r(a[o],o,a)!==!1;);return n}}function si(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),u=a.length;u--;){var s=a[t?u:++i];if(n(o[s],s,o)===!1)break}return e}}function ci(t,e,n){function r(){var e=this&&this!==Fn&&this instanceof r?o:t;return e.apply(i?n:this,arguments)}var i=e&X,o=fi(t);return r}function hi(t){return function(e){e=Ju(e);var n=mn.test(e)?J(e):$,r=n?n[0]:e.charAt(0),i=n?Hr(n,1).join(""):e.slice(1);return r[t]()+i}}function li(t){return function(e){return f(Us(xs(e).replace(pn,"")),t,"")}}function fi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Pn(t.prototype),r=t.apply(n,e);return yu(r)?r:n}}function gi(t,e,r){function i(){for(var a=arguments.length,u=Array(a),s=a,c=Bi(i);s--;)u[s]=arguments[s];var h=3>a&&u[0]!==c&&u[a-1]!==c?[]:W(u,c);if(a-=h.length,r>a)return Di(t,e,vi,i.placeholder,$,u,h,$,$,r-a);var l=this&&this!==Fn&&this instanceof i?o:t;return n(l,this,u)}var o=fi(t);return i}function pi(t){return function(e,n,r){var i=Object(e);if(n=Li(n,3),!iu(e))var o=rs(e);var a=t(o||e,function(t,e){return o&&(e=t,t=i[e]),n(t,e,i)},r);return a>-1?e[o?o[a]:a]:$}}function di(t){return qa(function(e){e=Un(e,1);var n=e.length,r=n,i=Me.prototype.thru;for(t&&e.reverse();r--;){var o=e[r];if("function"!=typeof o)throw new xc(Z);if(i&&!a&&"wrapper"==Pi(o))var a=new Me([],!0)}for(r=a?r:n;++r<n;){o=e[r];var u=Pi(o),s="wrapper"==u?Ch(o):$;a=s&&to(s[0])&&s[1]==(at|nt|it|ut)&&!s[4].length&&1==s[9]?a[Pi(s[0])].apply(a,s[3]):1==o.length&&to(o)?a[u]():a.thru(o)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&vl(r)&&r.length>=V)return a.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}})}function vi(t,e,n,r,i,o,a,u,s,c){function h(){for(var y=arguments.length,m=Array(y),b=y;b--;)m[b]=arguments[b];if(p)var _=Bi(h),w=O(m,_);if(r&&(m=ti(m,r,i,p)),o&&(m=ei(m,o,a,p)),y-=w,p&&c>y){var x=W(m,_);return Di(t,e,vi,h.placeholder,n,m,x,u,s,c-y)}var I=f?n:this,D=g?I[t]:t;return y=m.length,u?m=so(m,u):d&&y>1&&m.reverse(),l&&y>s&&(m.length=s),this&&this!==Fn&&this instanceof h&&(D=v||fi(D)),D.apply(I,m)}var l=e&at,f=e&X,g=e&tt,p=e&(nt|rt),d=e&st,v=g?$:fi(t);return h}function yi(t,e){return function(n,r){return Xn(n,t,e(r),{})}}function mi(t){return function(e,n){var r;if(e===$&&n===$)return 0;if(e!==$&&(r=e),n!==$){if(r===$)return n;"string"==typeof e||"string"==typeof n?(e=Mr(e),n=Mr(n)):(e=Or(e),n=Or(n)),r=t(e,n)}return r}}function bi(t){return qa(function(e){return e=1==e.length&&vl(e[0])?h(e[0],R(Li())):h(Un(e,1,Vi),R(Li())),qa(function(r){var i=this;return t(e,function(t){return n(t,i,r)})})})}function _i(t,e){e=e===$?" ":Mr(e);var n=e.length;if(2>n)return n?Dr(e,t):e;var r=Dr(e,Gc(t/H(e)));return mn.test(e)?Hr(J(r),0,t).join(""):r.slice(0,t)}function wi(t,e,r,i){function o(){for(var e=-1,s=arguments.length,c=-1,h=i.length,l=Array(h+s),f=this&&this!==Fn&&this instanceof o?u:t;++c<h;)l[c]=i[c];for(;s--;)l[c++]=arguments[++e];return n(f,a?r:this,l)}var a=e&X,u=fi(t);return o}function xi(t){return function(e,n,r){return r&&"number"!=typeof r&&Qi(e,n,r)&&(n=r=$),e=Nu(e),e=e===e?e:0,n===$?(n=e,e=0):n=Nu(n)||0,r=r===$?n>e?1:-1:Nu(r)||0,Ir(e,n,r,t)}}function Ii(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Nu(e),n=Nu(n)),t(e,n)}}function Di(t,e,n,r,i,o,a,u,s,c){var h=e&nt,l=h?a:$,f=h?$:a,g=h?o:$,p=h?$:o;e|=h?it:ot,e&=~(h?ot:it),e&et||(e&=~(X|tt));var d=[t,e,i,g,l,p,f,u,s,c],v=n.apply($,d);return to(t)&&Mh(v,d),v.placeholder=r,v}function Ri(t){var e=_c[t];return function(t,n){if(t=Nu(t),n=Xc(zu(n),292)){var r=(Ju(t)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+n));return r=(Ju(i)+"e").split("e"),+(r[0]+"e"+(+r[1]-n))}return e(t)}}function Si(t){return function(e){var n=Ni(e);return n==Mt?z(e):n==Et?U(e):D(e,t(e))}}function Ai(t,e,n,r,i,o,a,u){var s=e&tt;if(!s&&"function"!=typeof t)throw new xc(Z);var c=r?r.length:0;if(c||(e&=~(it|ot),r=i=$),a=a===$?a:Yc(zu(a),0),u=u===$?u:zu(u),c-=i?i.length:0,e&ot){var h=r,l=i;r=i=$}var f=s?$:Ch(t),g=[t,e,n,r,i,h,l,o,a,u];if(f&&oo(g,f),t=g[0],e=g[1],n=g[2],r=g[3],i=g[4],u=g[9]=null==g[9]?s?0:t.length:Yc(g[9]-c,0),!u&&e&(nt|rt)&&(e&=~(nt|rt)),e&&e!=X)p=e==nt||e==rt?gi(t,e,u):e!=it&&e!=(X|it)||i.length?vi.apply($,g):wi(t,e,n,r);else var p=ci(t,e,n);var d=f?Sh:Mh;return d(p,g)}function Ci(t,e,n,r,i,o){var a=i&ht,u=t.length,s=e.length;if(u!=s&&!(a&&s>u))return!1;var c=o.get(t);if(c)return c==e;var h=-1,l=!0,f=i&ct?new en:$;for(o.set(t,e);++h<u;){var g=t[h],d=e[h];if(r)var v=a?r(d,g,h,e,t,o):r(g,d,h,t,e,o);if(v!==$){if(v)continue;l=!1;break}if(f){if(!p(e,function(t,e){return f.has(e)||g!==t&&!n(g,t,r,i,o)?void 0:f.add(e)})){l=!1;break}}else if(g!==d&&!n(g,d,r,i,o)){l=!1;break}}return o["delete"](t),l}function ki(t,e,n,r,i,o,a){switch(n){case Ht:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Ut:return!(t.byteLength!=e.byteLength||!r(new Tc(t),new Tc(e)));case At:case Ct:return+t==+e;case kt:return t.name==e.name&&t.message==e.message;case Pt:return t!=+t?e!=+e:t==+e;case Ft:case Tt:return t==e+"";case Mt:var u=z;case Et:var s=o&ht;if(u||(u=N),t.size!=e.size&&!s)return!1;var c=a.get(t);return c?c==e:(o|=ct,a.set(t,e),Ci(u(t),u(e),r,i,o,a));case zt:if(_h)return _h.call(t)==_h.call(e)}return!1}function ji(t,e,n,r,i,o){var a=i&ht,u=rs(t),s=u.length,c=rs(e),h=c.length;if(s!=h&&!a)return!1;for(var l=s;l--;){var f=u[l];if(!(a?f in e:Vn(e,f)))return!1}var g=o.get(t);if(g)return g==e;var p=!0;o.set(t,e);for(var d=a;++l<s;){f=u[l];var v=t[f],y=e[f];if(r)var m=a?r(y,v,f,e,t,o):r(v,y,f,t,e,o);if(!(m===$?v===y||n(v,y,r,i,o):m)){p=!1;break}d||(d="constructor"==f)}if(p&&!d){var b=t.constructor,_=e.constructor;b!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _)&&(p=!1)}return o["delete"](t),p}function Oi(t){return $n(t,rs,Wi)}function Mi(t){return $n(t,is,jh)}function Pi(t){for(var e=t.name+"",n=gh[e],r=kc.call(gh,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Bi(t){var e=kc.call(je,"placeholder")?je:t;return e.placeholder}function Li(){var t=je.iteratee||$s;return t=t===$s?or:t,arguments.length?t(arguments[0],arguments[1]):t}function Fi(t,e){var n=t.__data__;return Xi(e)?n["string"==typeof e?"string":"hash"]:n.map}function Ei(t){for(var e=rs(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,ro(i)]}return e}function Ti(t,e){var n=L(t,e);return ir(n)?n:$}function zi(t){return Kc(Object(t))}function Wi(t){return Wc(Object(t))}function Ni(t){return Mc.call(t)}function Ui(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Xc(e,t+a);break;case"takeRight":t=Yc(t,e-a)}}return{start:t,end:e}}function Hi(t,e,n){e=Yi(e,t)?[e]:Ur(e);for(var r,i=-1,o=e.length;++i<o;){var a=co(e[i]);if(!(r=null!=t&&n(t,a)))break;t=t[a]}if(r)return r;var o=t?t.length:0;return!!o&&vu(o)&&Zi(a,o)&&(vl(t)||Ou(t)||nu(t))}function Ji(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&kc.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function qi(t){return"function"!=typeof t.constructor||no(t)?{}:Pn(zi(t))}function Gi(t,e,n,r){var i=t.constructor;switch(e){case Ut:return qr(t);case At:case Ct:return new i(+t);case Ht:return Gr(t,r);case Jt:case qt:case Gt:case $t:case Kt:case Vt:case Zt:case Qt:case Yt:return Qr(t,r);case Mt:return $r(t,r,n);case Pt:case Tt:return new i(t);case Ft:return Kr(t);case Et:return Vr(t,r,n);case zt:return Zr(t)}}function $i(t){var e=t?t.length:$;return vu(e)&&(vl(t)||Ou(t)||nu(t))?I(e,String):null}function Ki(t){return vl(t)||nu(t)}function Vi(t){return vl(t)&&!(2==t.length&&!pu(t[0]))}function Zi(t,e){return e=null==e?bt:e,!!e&&("number"==typeof t||Se.test(t))&&t>-1&&t%1==0&&e>t}function Qi(t,e,n){if(!yu(n))return!1;var r=typeof e;return("number"==r?iu(n)&&Zi(e,n.length):"string"==r&&e in n)?eu(n[e],t):!1}function Yi(t,e){if(vl(t))return!1;var n=typeof t;return"number"==n||"symbol"==n||"boolean"==n||null==t||Mu(t)?!0:he.test(t)||!ce.test(t)||null!=e&&t in Object(e)}function Xi(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function to(t){var e=Pi(t),n=je[e];if("function"!=typeof n||!(e in Pe.prototype))return!1;if(t===n)return!0;var r=Ch(n);return!!r&&t===r[0]}function eo(t){return!!Ac&&Ac in t}function no(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||Dc;return t===n}function ro(t){return t===t&&!yu(t)}function io(t,e){return function(n){return null==n?!1:n[t]===e&&(e!==$||t in Object(n))}}function oo(t,e){var n=t[1],r=e[1],i=n|r,o=(X|tt|at)>i,a=r==at&&n==nt||r==at&&n==ut&&t[7].length<=e[8]||r==(at|ut)&&e[7].length<=e[8]&&n==nt;if(!o&&!a)return t;r&X&&(t[2]=e[2],i|=n&X?0:et);var u=e[3];if(u){var s=t[3];t[3]=s?ti(s,u,e[4]):u,t[4]=s?W(t[3],Y):e[4]}return u=e[5],u&&(s=t[5],t[5]=s?ei(s,u,e[6]):u,t[6]=s?W(t[5],Y):e[6]),u=e[7],u&&(t[7]=u),r&at&&(t[8]=null==t[8]?e[8]:Xc(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function ao(t,e,n,r,i,o){return yu(t)&&yu(e)&&fr(t,e,$,ao,o.set(e,t)),t}function uo(t,e){return 1==e.length?t:Gn(t,Sr(e,0,-1))}function so(t,e){for(var n=t.length,r=Xc(e.length,n),i=ni(t);r--;){var o=e[r];t[r]=Zi(o,n)?i[o]:$}return t}function co(t){if("string"==typeof t||Mu(t))return t;var e=t+"";return"0"==e&&1/t==-mt?"-0":e}function ho(t){if(null!=t){try{return Cc.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function lo(t){if(t instanceof Pe)return t.clone();var e=new Me(t.__wrapped__,t.__chain__);return e.__actions__=ni(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function fo(t,e,n){e=(n?Qi(t,e,n):e===$)?1:Yc(zu(e),0);var r=t?t.length:0;if(!r||1>e)return[];for(var i=0,o=0,a=Array(Gc(r/e));r>i;)a[o++]=Sr(t,i,i+=e);return a}function go(t){for(var e=-1,n=t?t.length:0,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i}function po(){for(var t=arguments.length,e=Array(t?t-1:0),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return t?l(vl(n)?ni(n):[n],Un(e,1)):[]}function vo(t,e,n){var r=t?t.length:0;return r?(e=n||e===$?1:zu(e),Sr(t,0>e?0:e,r)):[]}function yo(t,e,n){var r=t?t.length:0;return r?(e=n||e===$?1:zu(e),e=r-e,Sr(t,0,0>e?0:e)):[]}function mo(t,e){return t&&t.length?Fr(t,Li(e,3),!0,!0):[]}function bo(t,e){return t&&t.length?Fr(t,Li(e,3),!0):[]}function _o(t,e,n,r){var i=t?t.length:0;return i?(n&&"number"!=typeof n&&Qi(t,e,n)&&(n=0,r=i),Wn(t,e,n,r)):[]}function wo(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=null==n?0:zu(n);return 0>i&&(i=Yc(r+i,0)),v(t,Li(e,3),i)}function xo(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=r-1;return n!==$&&(i=zu(n),i=0>n?Yc(r+i,0):Xc(i,r-1)),v(t,Li(e,3),i,!0)}function Io(t){var e=t?t.length:0;return e?Un(t,1):[]}function Do(t){var e=t?t.length:0;return e?Un(t,mt):[]}function Ro(t,e){var n=t?t.length:0;return n?(e=e===$?1:zu(e),Un(t,e)):[]}function So(t){for(var e=-1,n=t?t.length:0,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r}function Ao(t){return t&&t.length?t[0]:$}function Co(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=null==n?0:zu(n);return 0>i&&(i=Yc(r+i,0)),y(t,e,i)}function ko(t){return yo(t,1)}function jo(t,e){return t?Zc.call(t,e):""}function Oo(t){var e=t?t.length:0;return e?t[e-1]:$}function Mo(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=r;if(n!==$&&(i=zu(n),i=(0>i?Yc(r+i,0):Xc(i,r-1))+1),e!==e)return F(t,i-1,!0);for(;i--;)if(t[i]===e)return i;return-1}function Po(t,e){return t&&t.length?pr(t,zu(e)):$}function Bo(t,e){return t&&t.length&&e&&e.length?_r(t,e):t}function Lo(t,e,n){return t&&t.length&&e&&e.length?_r(t,e,Li(n)):t}function Fo(t,e,n){return t&&t.length&&e&&e.length?_r(t,e,$,n):t}function Eo(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=Li(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return wr(t,i),n}function To(t){return t?rh.call(t):t}function zo(t,e,n){var r=t?t.length:0;return r?(n&&"number"!=typeof n&&Qi(t,e,n)?(e=0,n=r):(e=null==e?0:zu(e),n=n===$?r:zu(n)),Sr(t,e,n)):[]}function Wo(t,e){return Cr(t,e)}function No(t,e,n){return kr(t,e,Li(n))}function Uo(t,e){var n=t?t.length:0;if(n){var r=Cr(t,e);if(n>r&&eu(t[r],e))return r}return-1}function Ho(t,e){return Cr(t,e,!0)}function Jo(t,e,n){return kr(t,e,Li(n),!0)}function qo(t,e){var n=t?t.length:0;if(n){var r=Cr(t,e,!0)-1;if(eu(t[r],e))return r}return-1}function Go(t){return t&&t.length?jr(t):[]}function $o(t,e){return t&&t.length?jr(t,Li(e)):[]}function Ko(t){return vo(t,1)}function Vo(t,e,n){return t&&t.length?(e=n||e===$?1:zu(e),Sr(t,0,0>e?0:e)):[]}function Zo(t,e,n){var r=t?t.length:0;return r?(e=n||e===$?1:zu(e),e=r-e,Sr(t,0>e?0:e,r)):[]}function Qo(t,e){return t&&t.length?Fr(t,Li(e,3),!1,!0):[]}function Yo(t,e){return t&&t.length?Fr(t,Li(e,3)):[]}function Xo(t){return t&&t.length?Pr(t):[]}function ta(t,e){return t&&t.length?Pr(t,Li(e)):[]}function ea(t,e){return t&&t.length?Pr(t,$,e):[]}function na(t){if(!t||!t.length)return[];var e=0;return t=u(t,function(t){return ou(t)?(e=Yc(t.length,e),!0):void 0}),I(e,function(e){return h(t,mr(e))})}function ra(t,e){if(!t||!t.length)return[];var r=na(t);return null==e?r:h(r,function(t){return n(e,$,t)})}function ia(t,e){return zr(t||[],e||[],gn)}function oa(t,e){return zr(t||[],e||[],Rr)}function aa(t){var e=je(t);return e.__chain__=!0,e}function ua(t,e){return e(t),t}function sa(t,e){return e(t)}function ca(){return aa(this)}function ha(){return new Me(this.value(),this.__chain__)}function la(){this.__values__===$&&(this.__values__=Eu(this.value()));var t=this.__index__>=this.__values__.length,e=t?$:this.__values__[this.__index__++];return{done:t,value:e}}function fa(){return this}function ga(t){for(var e,n=this;n instanceof Oe;){var r=lo(n);r.__index__=0,r.__values__=$,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e}function pa(){var t=this.__wrapped__;if(t instanceof Pe){var e=t;return this.__actions__.length&&(e=new Pe(this)),e=e.reverse(),e.__actions__.push({func:sa,args:[To],thisArg:$}),new Me(e,this.__chain__)}return this.thru(To)}function da(){return Er(this.__wrapped__,this.__actions__)}function va(t,e,n){var r=vl(t)?a:Tn;return n&&Qi(t,e,n)&&(e=$),r(t,Li(e,3))}function ya(t,e){var n=vl(t)?u:Nn;
return n(t,Li(e,3))}function ma(t,e){return Un(Da(t,e),1)}function ba(t,e){return Un(Da(t,e),mt)}function _a(t,e,n){return n=n===$?1:zu(n),Un(Da(t,e),n)}function wa(t,e){var n=vl(t)?i:xh;return n(t,Li(e,3))}function xa(t,e){var n=vl(t)?o:Ih;return n(t,Li(e,3))}function Ia(t,e,n,r){t=iu(t)?t:vs(t),n=n&&!r?zu(n):0;var i=t.length;return 0>n&&(n=Yc(i+n,0)),Ou(t)?i>=n&&t.indexOf(e,n)>-1:!!i&&y(t,e,n)>-1}function Da(t,e){var n=vl(t)?h:cr;return n(t,Li(e,3))}function Ra(t,e,n,r){return null==t?[]:(vl(e)||(e=null==e?[]:[e]),n=r?$:n,vl(n)||(n=null==n?[]:[n]),dr(t,e,n))}function Sa(t,e,n){var r=vl(t)?f:_,i=arguments.length<3;return r(t,Li(e,4),n,i,xh)}function Aa(t,e,n){var r=vl(t)?g:_,i=arguments.length<3;return r(t,Li(e,4),n,i,Ih)}function Ca(t,e){var n=vl(t)?u:Nn;return e=Li(e,3),n(t,function(t,n,r){return!e(t,n,r)})}function ka(t){var e=iu(t)?t:vs(t),n=e.length;return n>0?e[xr(0,n-1)]:$}function ja(t,e,n){var r=-1,i=Eu(t),o=i.length,a=o-1;for(e=(n?Qi(t,e,n):e===$)?1:An(zu(e),0,o);++r<e;){var u=xr(r,a),s=i[u];i[u]=i[r],i[r]=s}return i.length=e,i}function Oa(t){return ja(t,xt)}function Ma(t){if(null==t)return 0;if(iu(t)){var e=t.length;return e&&Ou(t)?H(t):e}if(mu(t)){var n=Ni(t);if(n==Mt||n==Et)return t.size}return rs(t).length}function Pa(t,e,n){var r=vl(t)?p:Ar;return n&&Qi(t,e,n)&&(e=$),r(t,Li(e,3))}function Ba(){return mc.now()}function La(t,e){if("function"!=typeof e)throw new xc(Z);return t=zu(t),function(){return--t<1?e.apply(this,arguments):void 0}}function Fa(t,e,n){return e=n?$:e,e=t&&null==e?t.length:e,Ai(t,at,$,$,$,$,e)}function Ea(t,e){var n;if("function"!=typeof e)throw new xc(Z);return t=zu(t),function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=$),n}}function Ta(t,e,n){e=n?$:e;var r=Ai(t,nt,$,$,$,$,$,e);return r.placeholder=Ta.placeholder,r}function za(t,e,n){e=n?$:e;var r=Ai(t,rt,$,$,$,$,$,e);return r.placeholder=za.placeholder,r}function Wa(t,e,n){function r(e){var n=f,r=g;return f=g=$,m=e,d=t.apply(r,n)}function i(t){return m=t,v=qc(u,e),b?r(t):d}function o(t){var n=t-y,r=t-m,i=e-n;return _?Xc(i,p-r):i}function a(t){var n=t-y,r=t-m;return y===$||n>=e||0>n||_&&r>=p}function u(){var t=Ba();return a(t)?s(t):void(v=qc(u,o(t)))}function s(t){return v=$,w&&f?r(t):(f=g=$,d)}function c(){m=0,f=y=g=v=$}function h(){return v===$?d:s(Ba())}function l(){var t=Ba(),n=a(t);if(f=arguments,g=this,y=t,n){if(v===$)return i(y);if(_)return v=qc(u,e),r(y)}return v===$&&(v=qc(u,e)),d}var f,g,p,d,v,y,m=0,b=!1,_=!1,w=!0;if("function"!=typeof t)throw new xc(Z);return e=Nu(e)||0,yu(n)&&(b=!!n.leading,_="maxWait"in n,p=_?Yc(Nu(n.maxWait)||0,e):p,w="trailing"in n?!!n.trailing:w),l.cancel=c,l.flush=h,l}function Na(t){return Ai(t,st)}function Ua(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new xc(Z);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a),a};return n.cache=new(Ua.Cache||Ve),n}function Ha(t){if("function"!=typeof t)throw new xc(Z);return function(){return!t.apply(this,arguments)}}function Ja(t){return Ea(2,t)}function qa(t,e){if("function"!=typeof t)throw new xc(Z);return e=Yc(e===$?t.length-1:zu(e),0),function(){for(var r=arguments,i=-1,o=Yc(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,r[0],a);case 2:return t.call(this,r[0],r[1],a)}var u=Array(e+1);for(i=-1;++i<e;)u[i]=r[i];return u[e]=a,n(t,this,u)}}function Ga(t,e){if("function"!=typeof t)throw new xc(Z);return e=e===$?0:Yc(zu(e),0),qa(function(r){var i=r[e],o=Hr(r,0,e);return i&&l(o,i),n(t,this,o)})}function $a(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new xc(Z);return yu(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Wa(t,e,{leading:r,maxWait:e,trailing:i})}function Ka(t){return Fa(t,1)}function Va(t,e){return e=null==e?Gs:e,ll(e,t)}function Za(){if(!arguments.length)return[];var t=arguments[0];return vl(t)?t:[t]}function Qa(t){return jn(t,!1,!0)}function Ya(t,e){return jn(t,!1,!0,e)}function Xa(t){return jn(t,!0,!0)}function tu(t,e){return jn(t,!0,!0,e)}function eu(t,e){return t===e||t!==t&&e!==e}function nu(t){return ou(t)&&kc.call(t,"callee")&&(!Hc.call(t,"callee")||Mc.call(t)==Rt)}function ru(t){return mu(t)&&Mc.call(t)==Ut}function iu(t){return null!=t&&vu(kh(t))&&!pu(t)}function ou(t){return mu(t)&&iu(t)}function au(t){return t===!0||t===!1||mu(t)&&Mc.call(t)==At}function uu(t){return mu(t)&&Mc.call(t)==Ct}function su(t){return!!t&&1===t.nodeType&&mu(t)&&!Au(t)}function cu(t){if(iu(t)&&(vl(t)||Ou(t)||pu(t.splice)||nu(t)||yl(t)))return!t.length;if(mu(t)){var e=Ni(t);if(e==Mt||e==Et)return!t.size}for(var n in t)if(kc.call(t,n))return!1;return!(fh&&rs(t).length)}function hu(t,e){return er(t,e)}function lu(t,e,n){n="function"==typeof n?n:$;var r=n?n(t,e):$;return r===$?er(t,e,n):!!r}function fu(t){return mu(t)?Mc.call(t)==kt||"string"==typeof t.message&&"string"==typeof t.name:!1}function gu(t){return"number"==typeof t&&Vc(t)}function pu(t){var e=yu(t)?Mc.call(t):"";return e==jt||e==Ot}function du(t){return"number"==typeof t&&t==zu(t)}function vu(t){return"number"==typeof t&&t>-1&&t%1==0&&bt>=t}function yu(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function mu(t){return!!t&&"object"==typeof t}function bu(t){return mu(t)&&Ni(t)==Mt}function _u(t,e){return t===e||rr(t,e,Ei(e))}function wu(t,e,n){return n="function"==typeof n?n:$,rr(t,e,Ei(e),n)}function xu(t){return Su(t)&&t!=+t}function Iu(t){if(Oh(t))throw new bc("This method is not supported with `core-js`. Try https://github.com/es-shims.");return ir(t)}function Du(t){return null===t}function Ru(t){return null==t}function Su(t){return"number"==typeof t||mu(t)&&Mc.call(t)==Pt}function Au(t){if(!mu(t)||Mc.call(t)!=Bt||E(t))return!1;var e=zi(t);if(null===e)return!0;var n=kc.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Cc.call(n)==Oc}function Cu(t){return yu(t)&&Mc.call(t)==Ft}function ku(t){return du(t)&&t>=-bt&&bt>=t}function ju(t){return mu(t)&&Ni(t)==Et}function Ou(t){return"string"==typeof t||!vl(t)&&mu(t)&&Mc.call(t)==Tt}function Mu(t){return"symbol"==typeof t||mu(t)&&Mc.call(t)==zt}function Pu(t){return mu(t)&&vu(t.length)&&!!xn[Mc.call(t)]}function Bu(t){return t===$}function Lu(t){return mu(t)&&Ni(t)==Wt}function Fu(t){return mu(t)&&Mc.call(t)==Nt}function Eu(t){if(!t)return[];if(iu(t))return Ou(t)?J(t):ni(t);if(Nc&&t[Nc])return T(t[Nc]());var e=Ni(t),n=e==Mt?z:e==Et?N:vs;return n(t)}function Tu(t){if(!t)return 0===t?t:0;if(t=Nu(t),t===mt||t===-mt){var e=0>t?-1:1;return e*_t}return t===t?t:0}function zu(t){var e=Tu(t),n=e%1;return e===e?n?e-n:e:0}function Wu(t){return t?An(zu(t),0,xt):0}function Nu(t){if("number"==typeof t)return t;if(Mu(t))return wt;if(yu(t)){var e=pu(t.valueOf)?t.valueOf():t;t=yu(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(pe,"");var n=Ie.test(t);return n||Re.test(t)?kn(t.slice(2),n?2:8):xe.test(t)?wt:+t}function Uu(t){return ri(t,is(t))}function Hu(t){return An(zu(t),-bt,bt)}function Ju(t){return null==t?"":Mr(t)}function qu(t,e){var n=Pn(t);return e?Rn(n,e):n}function Gu(t,e){return d(t,Li(e,3),Hn)}function $u(t,e){return d(t,Li(e,3),Jn)}function Ku(t,e){return null==t?t:Dh(t,Li(e,3),is)}function Vu(t,e){return null==t?t:Rh(t,Li(e,3),is)}function Zu(t,e){return t&&Hn(t,Li(e,3))}function Qu(t,e){return t&&Jn(t,Li(e,3))}function Yu(t){return null==t?[]:qn(t,rs(t))}function Xu(t){return null==t?[]:qn(t,is(t))}function ts(t,e,n){var r=null==t?$:Gn(t,e);return r===$?n:r}function es(t,e){return null!=t&&Hi(t,e,Vn)}function ns(t,e){return null!=t&&Hi(t,e,Zn)}function rs(t){var e=no(t);if(!e&&!iu(t))return ar(t);var n=$i(t),r=!!n,i=n||[],o=i.length;for(var a in t)!Vn(t,a)||r&&("length"==a||Zi(a,o))||e&&"constructor"==a||i.push(a);return i}function is(t){for(var e=-1,n=no(t),r=ur(t),i=r.length,o=$i(t),a=!!o,u=o||[],s=u.length;++e<i;){var c=r[e];a&&("length"==c||Zi(c,s))||"constructor"==c&&(n||!kc.call(t,c))||u.push(c)}return u}function os(t,e){var n={};return e=Li(e,3),Hn(t,function(t,r,i){n[e(t,r,i)]=t}),n}function as(t,e){var n={};return e=Li(e,3),Hn(t,function(t,r,i){n[r]=e(t,r,i)}),n}function us(t,e){return e=Li(e),yr(t,function(t,n){return!e(t,n)})}function ss(t,e){return null==t?{}:yr(t,Li(e))}function cs(t,e,n){e=Yi(e,t)?[e]:Ur(e);var r=-1,i=e.length;for(i||(t=$,i=1);++r<i;){var o=null==t?$:t[co(e[r])];o===$&&(r=i,o=n),t=pu(o)?o.call(t):o}return t}function hs(t,e,n){return null==t?t:Rr(t,e,n)}function ls(t,e,n,r){return r="function"==typeof r?r:$,null==t?t:Rr(t,e,n,r)}function fs(t,e,n){var r=vl(t)||Pu(t);if(e=Li(e,4),null==n)if(r||yu(t)){var o=t.constructor;n=r?vl(t)?new o:[]:pu(o)?Pn(zi(t)):{}}else n={};return(r?i:Hn)(t,function(t,r,i){return e(n,t,r,i)}),n}function gs(t,e){return null==t?!0:Br(t,e)}function ps(t,e,n){return null==t?t:Lr(t,e,Nr(n))}function ds(t,e,n,r){return r="function"==typeof r?r:$,null==t?t:Lr(t,e,Nr(n),r)}function vs(t){return t?S(t,rs(t)):[]}function ys(t){return null==t?[]:S(t,is(t))}function ms(t,e,n){return n===$&&(n=e,e=$),n!==$&&(n=Nu(n),n=n===n?n:0),e!==$&&(e=Nu(e),e=e===e?e:0),An(Nu(t),e,n)}function bs(t,e,n){return e=Nu(e)||0,n===$?(n=e,e=0):n=Nu(n)||0,t=Nu(t),Qn(t,e,n)}function _s(t,e,n){if(n&&"boolean"!=typeof n&&Qi(t,e,n)&&(e=n=$),n===$&&("boolean"==typeof e?(n=e,e=$):"boolean"==typeof t&&(n=t,t=$)),t===$&&e===$?(t=0,e=1):(t=Nu(t)||0,e===$?(e=t,t=0):e=Nu(e)||0),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=eh();return Xc(t+i*(e-t+Cn("1e-"+((i+"").length-1))),e)}return xr(t,e)}function ws(t){return Hl(Ju(t).toLowerCase())}function xs(t){return t=Ju(t),t&&t.replace(Ae,M).replace(dn,"")}function Is(t,e,n){t=Ju(t),e=Mr(e);var r=t.length;return n=n===$?r:An(zu(n),0,r),n-=e.length,n>=0&&t.indexOf(e,n)==n}function Ds(t){return t=Ju(t),t&&oe.test(t)?t.replace(re,P):t}function Rs(t){return t=Ju(t),t&&ge.test(t)?t.replace(fe,"\\$&"):t}function Ss(t,e,n){t=Ju(t),e=zu(e);var r=e?H(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return _i($c(i),n)+t+_i(Gc(i),n)}function As(t,e,n){t=Ju(t),e=zu(e);var r=e?H(t):0;return e&&e>r?t+_i(e-r,n):t}function Cs(t,e,n){t=Ju(t),e=zu(e);var r=e?H(t):0;return e&&e>r?_i(e-r,n)+t:t}function ks(t,e,n){return n||null==e?e=0:e&&(e=+e),t=Ju(t).replace(pe,""),th(t,e||(we.test(t)?16:10))}function js(t,e,n){return e=(n?Qi(t,e,n):e===$)?1:zu(e),Dr(Ju(t),e)}function Os(){var t=arguments,e=Ju(t[0]);return t.length<3?e:nh.call(e,t[1],t[2])}function Ms(t,e,n){return n&&"number"!=typeof n&&Qi(t,e,n)&&(e=n=$),(n=n===$?xt:n>>>0)?(t=Ju(t),t&&("string"==typeof e||null!=e&&!Cu(e))&&(e=Mr(e),""==e&&mn.test(t))?Hr(J(t),0,n):ih.call(t,e,n)):[]}function Ps(t,e,n){return t=Ju(t),n=An(zu(n),0,t.length),t.lastIndexOf(Mr(e),n)==n}function Bs(t,e,n){var r=je.templateSettings;n&&Qi(t,e,n)&&(e=$),t=Ju(t),e=xl({},e,r,ln);var i,o,a=xl({},e.imports,r.imports,ln),u=rs(a),s=S(a,u),c=0,h=e.interpolate||Ce,l="__p += '",f=wc((e.escape||Ce).source+"|"+h.source+"|"+(h===se?be:Ce).source+"|"+(e.evaluate||Ce).source+"|$","g"),g="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++wn+"]")+"\n";t.replace(f,function(e,n,r,a,u,s){return r||(r=a),l+=t.slice(c,s).replace(ke,B),n&&(i=!0,l+="' +\n__e("+n+") +\n'"),u&&(o=!0,l+="';\n"+u+";\n__p += '"),r&&(l+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=s+e.length,e}),l+="';\n";var p=e.variable;p||(l="with (obj) {\n"+l+"\n}\n"),l=(o?l.replace(Xt,""):l).replace(te,"$1").replace(ee,"$1;"),l="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var d=Jl(function(){return Function(u,g+"return "+l).apply($,s)});if(d.source=l,fu(d))throw d;return d}function Ls(t){return Ju(t).toLowerCase()}function Fs(t){return Ju(t).toUpperCase()}function Es(t,e,n){if(t=Ju(t),t&&(n||e===$))return t.replace(pe,"");if(!t||!(e=Mr(e)))return t;var r=J(t),i=J(e),o=C(r,i),a=k(r,i)+1;return Hr(r,o,a).join("")}function Ts(t,e,n){if(t=Ju(t),t&&(n||e===$))return t.replace(ve,"");if(!t||!(e=Mr(e)))return t;var r=J(t),i=k(r,J(e))+1;return Hr(r,0,i).join("")}function zs(t,e,n){if(t=Ju(t),t&&(n||e===$))return t.replace(de,"");if(!t||!(e=Mr(e)))return t;var r=J(t),i=C(r,J(e));return Hr(r,i).join("")}function Ws(t,e){var n=lt,r=ft;if(yu(e)){var i="separator"in e?e.separator:i;n="length"in e?zu(e.length):n,r="omission"in e?Mr(e.omission):r}t=Ju(t);var o=t.length;if(mn.test(t)){var a=J(t);o=a.length}if(n>=o)return t;var u=n-H(r);if(1>u)return r;var s=a?Hr(a,0,u).join(""):t.slice(0,u);if(i===$)return s+r;if(a&&(u+=s.length-u),Cu(i)){if(t.slice(u).search(i)){var c,h=s;for(i.global||(i=wc(i.source,Ju(_e.exec(i))+"g")),i.lastIndex=0;c=i.exec(h);)var l=c.index;s=s.slice(0,l===$?u:l)}}else if(t.indexOf(Mr(i),u)!=u){var f=s.lastIndexOf(i);f>-1&&(s=s.slice(0,f))}return s+r}function Ns(t){return t=Ju(t),t&&ie.test(t)?t.replace(ne,q):t}function Us(t,e,n){return t=Ju(t),e=n?$:e,e===$&&(e=bn.test(t)?yn:ye),t.match(e)||[]}function Hs(t){var e=t?t.length:0,r=Li();return t=e?h(t,function(t){if("function"!=typeof t[1])throw new xc(Z);return[r(t[0]),t[1]]}):[],qa(function(r){for(var i=-1;++i<e;){var o=t[i];if(n(o[0],this,r))return n(o[1],this,r)}})}function Js(t){return On(jn(t,!0))}function qs(t){return function(){return t}}function Gs(t){return t}function $s(t){return or("function"==typeof t?t:jn(t,!0))}function Ks(t){return hr(jn(t,!0))}function Vs(t,e){return lr(t,jn(e,!0))}function Zs(t,e,n){var r=rs(e),o=qn(e,r);null!=n||yu(e)&&(o.length||!r.length)||(n=e,e=t,t=this,o=qn(e,rs(e)));var a=!(yu(n)&&"chain"in n&&!n.chain),u=pu(t);return i(o,function(n){var r=e[n];t[n]=r,u&&(t.prototype[n]=function(){var e=this.__chain__;if(a||e){var n=t(this.__wrapped__),i=n.__actions__=ni(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,l([this.value()],arguments))})}),t}function Qs(){return Fn._===this&&(Fn._=Pc),this}function Ys(){}function Xs(t){return t=zu(t),qa(function(e){return pr(e,t)})}function tc(t){return Yi(t)?mr(co(t)):br(t)}function ec(t){return function(e){return null==t?$:Gn(t,e)}}function nc(){return[]}function rc(){return!1}function ic(){return{}}function oc(){return""}function ac(){return!0}function uc(t,e){if(t=zu(t),1>t||t>bt)return[];var n=xt,r=Xc(t,xt);e=Li(e),t-=xt;for(var i=I(r,e);++n<t;)e(n);return i}function sc(t){return vl(t)?h(t,co):Mu(t)?[t]:ni(Ph(t))}function cc(t){var e=++jc;return Ju(t)+e}function hc(t){return t&&t.length?zn(t,Gs,Kn):$}function lc(t,e){return t&&t.length?zn(t,Li(e),Kn):$}function fc(t){return b(t,Gs)}function gc(t,e){return b(t,Li(e))}function pc(t){return t&&t.length?zn(t,Gs,sr):$}function dc(t,e){return t&&t.length?zn(t,Li(e),sr):$}function vc(t){return t&&t.length?x(t,Gs):0}function yc(t,e){return t&&t.length?x(t,Li(e)):0}j=j?En.defaults({},j,En.pick(Fn,_n)):Fn;var mc=j.Date,bc=j.Error,_c=j.Math,wc=j.RegExp,xc=j.TypeError,Ic=j.Array.prototype,Dc=j.Object.prototype,Rc=j.String.prototype,Sc=j["__core-js_shared__"],Ac=function(){var t=/[^.]+$/.exec(Sc&&Sc.keys&&Sc.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Cc=j.Function.prototype.toString,kc=Dc.hasOwnProperty,jc=0,Oc=Cc.call(Object),Mc=Dc.toString,Pc=Fn._,Bc=wc("^"+Cc.call(kc).replace(fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lc=Mn?j.Buffer:$,Fc=j.Reflect,Ec=j.Symbol,Tc=j.Uint8Array,zc=Fc?Fc.enumerate:$,Wc=Object.getOwnPropertySymbols,Nc="symbol"==typeof(Nc=Ec&&Ec.iterator)?Nc:$,Uc=Object.create,Hc=Dc.propertyIsEnumerable,Jc=Ic.splice,qc=function(t,e){return j.setTimeout.call(Fn,t,e)},Gc=_c.ceil,$c=_c.floor,Kc=Object.getPrototypeOf,Vc=j.isFinite,Zc=Ic.join,Qc=Object.keys,Yc=_c.max,Xc=_c.min,th=j.parseInt,eh=_c.random,nh=Rc.replace,rh=Ic.reverse,ih=Rc.split,oh=Ti(j,"DataView"),ah=Ti(j,"Map"),uh=Ti(j,"Promise"),sh=Ti(j,"Set"),ch=Ti(j,"WeakMap"),hh=Ti(Object,"create"),lh=ch&&new ch,fh=!Hc.call({valueOf:1},"valueOf"),gh={},ph=ho(oh),dh=ho(ah),vh=ho(uh),yh=ho(sh),mh=ho(ch),bh=Ec?Ec.prototype:$,_h=bh?bh.valueOf:$,wh=bh?bh.toString:$;je.templateSettings={escape:ae,evaluate:ue,interpolate:se,variable:"",imports:{_:je}},je.prototype=Oe.prototype,je.prototype.constructor=je,Me.prototype=Pn(Oe.prototype),Me.prototype.constructor=Me,Pe.prototype=Pn(Oe.prototype),Pe.prototype.constructor=Pe,Ee.prototype.clear=Te,Ee.prototype["delete"]=ze,Ee.prototype.get=We,Ee.prototype.has=Ne,Ee.prototype.set=Ue,He.prototype.clear=Je,He.prototype["delete"]=qe,He.prototype.get=Ge,He.prototype.has=$e,He.prototype.set=Ke,Ve.prototype.clear=Ze,Ve.prototype["delete"]=Qe,Ve.prototype.get=Ye,Ve.prototype.has=Xe,Ve.prototype.set=tn,en.prototype.add=en.prototype.push=nn,en.prototype.has=rn,on.prototype.clear=an,on.prototype["delete"]=un,on.prototype.get=sn,on.prototype.has=cn,on.prototype.set=hn;var xh=ui(Hn),Ih=ui(Jn,!0),Dh=si(),Rh=si(!0);zc&&!Hc.call({valueOf:1},"valueOf")&&(ur=function(t){return T(zc(t))});var Sh=lh?function(t,e){return lh.set(t,e),t}:Gs,Ah=sh&&1/N(new sh([,-0]))[1]==mt?function(t){return new sh(t)}:Ys,Ch=lh?function(t){return lh.get(t)}:Ys,kh=mr("length");Wc||(Wi=nc);var jh=Wc?function(t){for(var e=[];t;)l(e,Wi(t)),t=zi(t);return e}:Wi;(oh&&Ni(new oh(new ArrayBuffer(1)))!=Ht||ah&&Ni(new ah)!=Mt||uh&&Ni(uh.resolve())!=Lt||sh&&Ni(new sh)!=Et||ch&&Ni(new ch)!=Wt)&&(Ni=function(t){var e=Mc.call(t),n=e==Bt?t.constructor:$,r=n?ho(n):$;if(r)switch(r){case ph:return Ht;case dh:return Mt;case vh:return Lt;case yh:return Et;case mh:return Wt}return e});var Oh=Sc?pu:rc,Mh=function(){var t=0,e=0;return function(n,r){var i=Ba(),o=pt-(i-e);if(e=i,o>0){if(++t>=gt)return n}else t=0;return Sh(n,r)}}(),Ph=Ua(function(t){var e=[];return Ju(t).replace(le,function(t,n,r,i){e.push(r?i.replace(me,"$1"):n||t)}),e}),Bh=qa(function(t,e){return ou(t)?Ln(t,Un(e,1,ou,!0)):[]}),Lh=qa(function(t,e){var n=Oo(e);return ou(n)&&(n=$),ou(t)?Ln(t,Un(e,1,ou,!0),Li(n)):[]}),Fh=qa(function(t,e){var n=Oo(e);return ou(n)&&(n=$),ou(t)?Ln(t,Un(e,1,ou,!0),$,n):[]}),Eh=qa(function(t){var e=h(t,Wr);return e.length&&e[0]===t[0]?Yn(e):[]}),Th=qa(function(t){var e=Oo(t),n=h(t,Wr);return e===Oo(n)?e=$:n.pop(),n.length&&n[0]===t[0]?Yn(n,Li(e)):[]}),zh=qa(function(t){var e=Oo(t),n=h(t,Wr);return e===Oo(n)?e=$:n.pop(),n.length&&n[0]===t[0]?Yn(n,$,e):[]}),Wh=qa(Bo),Nh=qa(function(t,e){e=Un(e,1);var n=t?t.length:0,r=Sn(t,e);return wr(t,h(e,function(t){return Zi(t,n)?+t:t}).sort(Yr)),r}),Uh=qa(function(t){return Pr(Un(t,1,ou,!0))}),Hh=qa(function(t){var e=Oo(t);return ou(e)&&(e=$),Pr(Un(t,1,ou,!0),Li(e))}),Jh=qa(function(t){var e=Oo(t);return ou(e)&&(e=$),Pr(Un(t,1,ou,!0),$,e)}),qh=qa(function(t,e){return ou(t)?Ln(t,e):[]}),Gh=qa(function(t){return Tr(u(t,ou))}),$h=qa(function(t){var e=Oo(t);return ou(e)&&(e=$),Tr(u(t,ou),Li(e))}),Kh=qa(function(t){var e=Oo(t);return ou(e)&&(e=$),Tr(u(t,ou),$,e)}),Vh=qa(na),Zh=qa(function(t){var e=t.length,n=e>1?t[e-1]:$;return n="function"==typeof n?(t.pop(),n):$,ra(t,n)}),Qh=qa(function(t){t=Un(t,1);var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return Sn(e,t)};return!(e>1||this.__actions__.length)&&r instanceof Pe&&Zi(n)?(r=r.slice(n,+n+(e?1:0)),r.__actions__.push({func:sa,args:[i],thisArg:$}),new Me(r,this.__chain__).thru(function(t){return e&&!t.length&&t.push($),t})):this.thru(i)}),Yh=oi(function(t,e,n){kc.call(t,n)?++t[n]:t[n]=1}),Xh=pi(wo),tl=pi(xo),el=oi(function(t,e,n){kc.call(t,n)?t[n].push(e):t[n]=[e]}),nl=qa(function(t,e,r){var i=-1,o="function"==typeof e,a=Yi(e),u=iu(t)?Array(t.length):[];return xh(t,function(t){var s=o?e:a&&null!=t?t[e]:$;u[++i]=s?n(s,t,r):tr(t,e,r)}),u}),rl=oi(function(t,e,n){t[n]=e}),il=oi(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),ol=qa(function(t,e){if(null==t)return[];var n=e.length;return n>1&&Qi(t,e[0],e[1])?e=[]:n>2&&Qi(e[0],e[1],e[2])&&(e=[e[0]]),e=1==e.length&&vl(e[0])?e[0]:Un(e,1,Vi),dr(t,e,[])}),al=qa(function(t,e,n){var r=X;if(n.length){var i=W(n,Bi(al));r|=it}return Ai(t,r,e,n,i)}),ul=qa(function(t,e,n){var r=X|tt;if(n.length){var i=W(n,Bi(ul));r|=it}return Ai(e,r,t,n,i)}),sl=qa(function(t,e){return Bn(t,1,e)}),cl=qa(function(t,e,n){return Bn(t,Nu(e)||0,n)});Ua.Cache=Ve;var hl=qa(function(t,e){e=1==e.length&&vl(e[0])?h(e[0],R(Li())):h(Un(e,1,Vi),R(Li()));var r=e.length;return qa(function(i){for(var o=-1,a=Xc(i.length,r);++o<a;)i[o]=e[o].call(this,i[o]);return n(t,this,i)})}),ll=qa(function(t,e){var n=W(e,Bi(ll));return Ai(t,it,$,e,n)}),fl=qa(function(t,e){var n=W(e,Bi(fl));return Ai(t,ot,$,e,n)}),gl=qa(function(t,e){return Ai(t,ut,$,$,$,Un(e,1))}),pl=Ii(Kn),dl=Ii(function(t,e){return t>=e}),vl=Array.isArray,yl=Lc?function(t){return t instanceof Lc}:rc,ml=Ii(sr),bl=Ii(function(t,e){return e>=t}),_l=ai(function(t,e){if(fh||no(e)||iu(e))return void ri(e,rs(e),t);for(var n in e)kc.call(e,n)&&gn(t,n,e[n])}),wl=ai(function(t,e){if(fh||no(e)||iu(e))return void ri(e,is(e),t);for(var n in e)gn(t,n,e[n])}),xl=ai(function(t,e,n,r){ri(e,is(e),t,r)}),Il=ai(function(t,e,n,r){ri(e,rs(e),t,r)}),Dl=qa(function(t,e){return Sn(t,Un(e,1))}),Rl=qa(function(t){return t.push($,ln),n(xl,$,t)}),Sl=qa(function(t){return t.push($,ao),n(Ol,$,t)}),Al=yi(function(t,e,n){t[e]=n},qs(Gs)),Cl=yi(function(t,e,n){kc.call(t,e)?t[e].push(n):t[e]=[n]},Li),kl=qa(tr),jl=ai(function(t,e,n){fr(t,e,n)}),Ol=ai(function(t,e,n,r){fr(t,e,n,r)}),Ml=qa(function(t,e){return null==t?{}:(e=h(Un(e,1),co),vr(t,Ln(Mi(t),e)))}),Pl=qa(function(t,e){return null==t?{}:vr(t,h(Un(e,1),co))}),Bl=Si(rs),Ll=Si(is),Fl=li(function(t,e,n){return e=e.toLowerCase(),t+(n?ws(e):e)}),El=li(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Tl=li(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),zl=hi("toLowerCase"),Wl=li(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),Nl=li(function(t,e,n){return t+(n?" ":"")+Hl(e)}),Ul=li(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),Hl=hi("toUpperCase"),Jl=qa(function(t,e){try{return n(t,$,e)}catch(r){return fu(r)?r:new bc(r)}}),ql=qa(function(t,e){return i(Un(e,1),function(e){e=co(e),t[e]=al(t[e],t)}),t}),Gl=di(),$l=di(!0),Kl=qa(function(t,e){return function(n){return tr(n,t,e)}}),Vl=qa(function(t,e){return function(n){return tr(t,n,e)}}),Zl=bi(h),Ql=bi(a),Yl=bi(p),Xl=xi(),tf=xi(!0),ef=mi(function(t,e){return t+e}),nf=Ri("ceil"),rf=mi(function(t,e){return t/e}),of=Ri("floor"),af=mi(function(t,e){return t*e}),uf=Ri("round"),sf=mi(function(t,e){return t-e});return je.after=La,je.ary=Fa,je.assign=_l,je.assignIn=wl,je.assignInWith=xl,je.assignWith=Il,je.at=Dl,je.before=Ea,je.bind=al,je.bindAll=ql,je.bindKey=ul,je.castArray=Za,je.chain=aa,je.chunk=fo,je.compact=go,je.concat=po,je.cond=Hs,je.conforms=Js,je.constant=qs,je.countBy=Yh,je.create=qu,je.curry=Ta,je.curryRight=za,je.debounce=Wa,je.defaults=Rl,je.defaultsDeep=Sl,je.defer=sl,je.delay=cl,je.difference=Bh,je.differenceBy=Lh,je.differenceWith=Fh,je.drop=vo,je.dropRight=yo,je.dropRightWhile=mo,je.dropWhile=bo,je.fill=_o,je.filter=ya,je.flatMap=ma,je.flatMapDeep=ba,je.flatMapDepth=_a,je.flatten=Io,je.flattenDeep=Do,je.flattenDepth=Ro,je.flip=Na,je.flow=Gl,je.flowRight=$l,je.fromPairs=So,je.functions=Yu,je.functionsIn=Xu,je.groupBy=el,je.initial=ko,je.intersection=Eh,je.intersectionBy=Th,je.intersectionWith=zh,je.invert=Al,je.invertBy=Cl,je.invokeMap=nl,je.iteratee=$s,je.keyBy=rl,je.keys=rs,je.keysIn=is,je.map=Da,je.mapKeys=os,je.mapValues=as,je.matches=Ks,je.matchesProperty=Vs,je.memoize=Ua,je.merge=jl,je.mergeWith=Ol,je.method=Kl,je.methodOf=Vl,je.mixin=Zs,je.negate=Ha,je.nthArg=Xs,je.omit=Ml,je.omitBy=us,je.once=Ja,je.orderBy=Ra,je.over=Zl,je.overArgs=hl,je.overEvery=Ql,je.overSome=Yl,je.partial=ll,je.partialRight=fl,je.partition=il,je.pick=Pl,je.pickBy=ss,je.property=tc,je.propertyOf=ec,je.pull=Wh,je.pullAll=Bo,je.pullAllBy=Lo,je.pullAllWith=Fo,je.pullAt=Nh,je.range=Xl,je.rangeRight=tf,je.rearg=gl,je.reject=Ca,je.remove=Eo,je.rest=qa,je.reverse=To,je.sampleSize=ja,je.set=hs,je.setWith=ls,je.shuffle=Oa,je.slice=zo,je.sortBy=ol,je.sortedUniq=Go,je.sortedUniqBy=$o,je.split=Ms,je.spread=Ga,je.tail=Ko,je.take=Vo,je.takeRight=Zo,je.takeRightWhile=Qo,je.takeWhile=Yo,je.tap=ua,je.throttle=$a,je.thru=sa,je.toArray=Eu,je.toPairs=Bl,je.toPairsIn=Ll,je.toPath=sc,je.toPlainObject=Uu,je.transform=fs,je.unary=Ka,je.union=Uh,je.unionBy=Hh,je.unionWith=Jh,je.uniq=Xo,je.uniqBy=ta,je.uniqWith=ea,je.unset=gs,je.unzip=na,je.unzipWith=ra,je.update=ps,je.updateWith=ds,je.values=vs,je.valuesIn=ys,je.without=qh,je.words=Us,je.wrap=Va,je.xor=Gh,je.xorBy=$h,je.xorWith=Kh,je.zip=Vh,je.zipObject=ia,je.zipObjectDeep=oa,je.zipWith=Zh,je.entries=Bl,je.entriesIn=Ll,je.extend=wl,je.extendWith=xl,Zs(je,je),je.add=ef,je.attempt=Jl,je.camelCase=Fl,je.capitalize=ws,je.ceil=nf,je.clamp=ms,je.clone=Qa,je.cloneDeep=Xa,je.cloneDeepWith=tu,je.cloneWith=Ya,je.deburr=xs,je.divide=rf,je.endsWith=Is,je.eq=eu,je.escape=Ds,je.escapeRegExp=Rs,je.every=va,je.find=Xh,je.findIndex=wo,je.findKey=Gu,je.findLast=tl,je.findLastIndex=xo,je.findLastKey=$u,je.floor=of,je.forEach=wa,je.forEachRight=xa,je.forIn=Ku,je.forInRight=Vu,je.forOwn=Zu,je.forOwnRight=Qu,je.get=ts,je.gt=pl,je.gte=dl,je.has=es,je.hasIn=ns,je.head=Ao,je.identity=Gs,je.includes=Ia,je.indexOf=Co,je.inRange=bs,je.invoke=kl,je.isArguments=nu,je.isArray=vl,je.isArrayBuffer=ru,je.isArrayLike=iu,je.isArrayLikeObject=ou,je.isBoolean=au,je.isBuffer=yl,je.isDate=uu,je.isElement=su,je.isEmpty=cu,je.isEqual=hu,je.isEqualWith=lu,je.isError=fu,je.isFinite=gu,je.isFunction=pu,je.isInteger=du,je.isLength=vu,je.isMap=bu,je.isMatch=_u,je.isMatchWith=wu,je.isNaN=xu,je.isNative=Iu,je.isNil=Ru,je.isNull=Du,je.isNumber=Su,je.isObject=yu,je.isObjectLike=mu,je.isPlainObject=Au,je.isRegExp=Cu,je.isSafeInteger=ku,je.isSet=ju,je.isString=Ou,je.isSymbol=Mu,je.isTypedArray=Pu,je.isUndefined=Bu,je.isWeakMap=Lu,je.isWeakSet=Fu,je.join=jo,je.kebabCase=El,je.last=Oo,je.lastIndexOf=Mo,je.lowerCase=Tl,je.lowerFirst=zl,je.lt=ml,je.lte=bl,je.max=hc,je.maxBy=lc,je.mean=fc,je.meanBy=gc,je.min=pc,je.minBy=dc,je.stubArray=nc,je.stubFalse=rc,je.stubObject=ic,je.stubString=oc,je.stubTrue=ac,je.multiply=af,je.nth=Po,je.noConflict=Qs,je.noop=Ys,je.now=Ba,je.pad=Ss,je.padEnd=As,je.padStart=Cs,je.parseInt=ks,je.random=_s,je.reduce=Sa,je.reduceRight=Aa,je.repeat=js,je.replace=Os,je.result=cs,je.round=uf,je.runInContext=G,je.sample=ka,je.size=Ma,je.snakeCase=Wl,je.some=Pa,je.sortedIndex=Wo,je.sortedIndexBy=No,je.sortedIndexOf=Uo,je.sortedLastIndex=Ho,je.sortedLastIndexBy=Jo,je.sortedLastIndexOf=qo,je.startCase=Nl,je.startsWith=Ps,je.subtract=sf,je.sum=vc,je.sumBy=yc,je.template=Bs,je.times=uc,je.toFinite=Tu,je.toInteger=zu,je.toLength=Wu,je.toLower=Ls,je.toNumber=Nu,je.toSafeInteger=Hu,je.toString=Ju,je.toUpper=Fs,je.trim=Es,je.trimEnd=Ts,je.trimStart=zs,je.truncate=Ws,je.unescape=Ns,je.uniqueId=cc,je.upperCase=Ul,je.upperFirst=Hl,je.each=wa,je.eachRight=xa,je.first=Ao,Zs(je,function(){var t={};return Hn(je,function(e,n){kc.call(je.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),je.VERSION=K,i(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){je[t].placeholder=je}),i(["drop","take"],function(t,e){Pe.prototype[t]=function(n){var r=this.__filtered__;if(r&&!e)return new Pe(this);n=n===$?1:Yc(zu(n),0);var i=this.clone();return r?i.__takeCount__=Xc(n,i.__takeCount__):i.__views__.push({size:Xc(n,xt),type:t+(i.__dir__<0?"Right":"")}),i},Pe.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),i(["filter","map","takeWhile"],function(t,e){var n=e+1,r=n==dt||n==yt;Pe.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Li(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),i(["head","last"],function(t,e){var n="take"+(e?"Right":"");Pe.prototype[t]=function(){return this[n](1).value()[0]}}),i(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");Pe.prototype[t]=function(){return this.__filtered__?new Pe(this):this[n](1)}}),Pe.prototype.compact=function(){return this.filter(Gs)},Pe.prototype.find=function(t){return this.filter(t).head()},Pe.prototype.findLast=function(t){return this.reverse().find(t)},Pe.prototype.invokeMap=qa(function(t,e){return"function"==typeof t?new Pe(this):this.map(function(n){return tr(n,t,e)})}),Pe.prototype.reject=function(t){return t=Li(t,3),this.filter(function(e){return!t(e)})},Pe.prototype.slice=function(t,e){t=zu(t);var n=this;return n.__filtered__&&(t>0||0>e)?new Pe(n):(0>t?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==$&&(e=zu(e),n=0>e?n.dropRight(-e):n.take(e-t)),n)},Pe.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Pe.prototype.toArray=function(){return this.take(xt)},Hn(Pe.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=je[r?"take"+("last"==e?"Right":""):e],o=r||/^find/.test(e);i&&(je.prototype[e]=function(){var e=this.__wrapped__,a=r?[1]:arguments,u=e instanceof Pe,s=a[0],c=u||vl(e),h=function(t){var e=i.apply(je,l([t],a));return r&&f?e[0]:e};c&&n&&"function"==typeof s&&1!=s.length&&(u=c=!1);var f=this.__chain__,g=!!this.__actions__.length,p=o&&!f,d=u&&!g;if(!o&&c){e=d?e:new Pe(this);var v=t.apply(e,a);return v.__actions__.push({func:sa,args:[h],thisArg:$}),new Me(v,f)}return p&&d?t.apply(this,a):(v=this.thru(h),p?r?v.value()[0]:v.value():v)})}),i(["pop","push","shift","sort","splice","unshift"],function(t){var e=Ic[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);je.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(vl(i)?i:[],t)}return this[n](function(n){return e.apply(vl(n)?n:[],t)})}}),Hn(Pe.prototype,function(t,e){var n=je[e];if(n){var r=n.name+"",i=gh[r]||(gh[r]=[]);i.push({name:e,func:n})}}),gh[vi($,tt).name]=[{name:"wrapper",func:$}],Pe.prototype.clone=Be,Pe.prototype.reverse=Le,Pe.prototype.value=Fe,je.prototype.at=Qh,je.prototype.chain=ca,je.prototype.commit=ha,je.prototype.next=la,je.prototype.plant=ga,je.prototype.reverse=pa,je.prototype.toJSON=je.prototype.valueOf=je.prototype.value=da,Nc&&(je.prototype[Nc]=fa),je}var $,K="4.13.1",V=200,Z="Expected a function",Q="__lodash_hash_undefined__",Y="__lodash_placeholder__",X=1,tt=2,et=4,nt=8,rt=16,it=32,ot=64,at=128,ut=256,st=512,ct=1,ht=2,lt=30,ft="...",gt=150,pt=16,dt=1,vt=2,yt=3,mt=1/0,bt=9007199254740991,_t=1.7976931348623157e308,wt=NaN,xt=4294967295,It=xt-1,Dt=xt>>>1,Rt="[object Arguments]",St="[object Array]",At="[object Boolean]",Ct="[object Date]",kt="[object Error]",jt="[object Function]",Ot="[object GeneratorFunction]",Mt="[object Map]",Pt="[object Number]",Bt="[object Object]",Lt="[object Promise]",Ft="[object RegExp]",Et="[object Set]",Tt="[object String]",zt="[object Symbol]",Wt="[object WeakMap]",Nt="[object WeakSet]",Ut="[object ArrayBuffer]",Ht="[object DataView]",Jt="[object Float32Array]",qt="[object Float64Array]",Gt="[object Int8Array]",$t="[object Int16Array]",Kt="[object Int32Array]",Vt="[object Uint8Array]",Zt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",Yt="[object Uint32Array]",Xt=/\b__p \+= '';/g,te=/\b(__p \+=) '' \+/g,ee=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ne=/&(?:amp|lt|gt|quot|#39|#96);/g,re=/[&<>"'`]/g,ie=RegExp(ne.source),oe=RegExp(re.source),ae=/<%-([\s\S]+?)%>/g,ue=/<%([\s\S]+?)%>/g,se=/<%=([\s\S]+?)%>/g,ce=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,he=/^\w*$/,le=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,fe=/[\\^$.*+?()[\]{}|]/g,ge=RegExp(fe.source),pe=/^\s+|\s+$/g,de=/^\s+/,ve=/\s+$/,ye=/[a-zA-Z0-9]+/g,me=/\\(\\)?/g,be=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_e=/\w*$/,we=/^0x/i,xe=/^[-+]0x[0-9a-f]+$/i,Ie=/^0b[01]+$/i,De=/^\[object .+?Constructor\]$/,Re=/^0o[0-7]+$/i,Se=/^(?:0|[1-9]\d*)$/,Ae=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ce=/($^)/,ke=/['\n\r\u2028\u2029\\]/g,je="\\ud800-\\udfff",Oe="\\u0300-\\u036f\\ufe20-\\ufe23",Me="\\u20d0-\\u20f0",Pe="\\u2700-\\u27bf",Be="a-z\\xdf-\\xf6\\xf8-\\xff",Le="\\xac\\xb1\\xd7\\xf7",Fe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ee="\\u2000-\\u206f",Te=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ze="A-Z\\xc0-\\xd6\\xd8-\\xde",We="\\ufe0e\\ufe0f",Ne=Le+Fe+Ee+Te,Ue="['’]",He="["+je+"]",Je="["+Ne+"]",qe="["+Oe+Me+"]",Ge="\\d+",$e="["+Pe+"]",Ke="["+Be+"]",Ve="[^"+je+Ne+Ge+Pe+Be+ze+"]",Ze="\\ud83c[\\udffb-\\udfff]",Qe="(?:"+qe+"|"+Ze+")",Ye="[^"+je+"]",Xe="(?:\\ud83c[\\udde6-\\uddff]){2}",tn="[\\ud800-\\udbff][\\udc00-\\udfff]",en="["+ze+"]",nn="\\u200d",rn="(?:"+Ke+"|"+Ve+")",on="(?:"+en+"|"+Ve+")",an="(?:"+Ue+"(?:d|ll|m|re|s|t|ve))?",un="(?:"+Ue+"(?:D|LL|M|RE|S|T|VE))?",sn=Qe+"?",cn="["+We+"]?",hn="(?:"+nn+"(?:"+[Ye,Xe,tn].join("|")+")"+cn+sn+")*",ln=cn+sn+hn,fn="(?:"+[$e,Xe,tn].join("|")+")"+ln,gn="(?:"+[Ye+qe+"?",qe,Xe,tn,He].join("|")+")",pn=RegExp(Ue,"g"),dn=RegExp(qe,"g"),vn=RegExp(Ze+"(?="+Ze+")|"+gn+ln,"g"),yn=RegExp([en+"?"+Ke+"+"+an+"(?="+[Je,en,"$"].join("|")+")",on+"+"+un+"(?="+[Je,en+rn,"$"].join("|")+")",en+"?"+rn+"+"+an,en+"+"+un,Ge,fn].join("|"),"g"),mn=RegExp("["+nn+je+Oe+Me+We+"]"),bn=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_n=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","isFinite","parseInt","setTimeout"],wn=-1,xn={};
xn[Jt]=xn[qt]=xn[Gt]=xn[$t]=xn[Kt]=xn[Vt]=xn[Zt]=xn[Qt]=xn[Yt]=!0,xn[Rt]=xn[St]=xn[Ut]=xn[At]=xn[Ht]=xn[Ct]=xn[kt]=xn[jt]=xn[Mt]=xn[Pt]=xn[Bt]=xn[Ft]=xn[Et]=xn[Tt]=xn[Wt]=!1;var In={};In[Rt]=In[St]=In[Ut]=In[Ht]=In[At]=In[Ct]=In[Jt]=In[qt]=In[Gt]=In[$t]=In[Kt]=In[Mt]=In[Pt]=In[Bt]=In[Ft]=In[Et]=In[Tt]=In[zt]=In[Vt]=In[Zt]=In[Qt]=In[Yt]=!0,In[kt]=In[jt]=In[Wt]=!1;var Dn={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Rn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Sn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},An={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Cn=parseFloat,kn=parseInt,jn="object"==typeof exports&&exports,On=jn&&"object"==typeof module&&module,Mn=On&&On.exports===jn,Pn=j("object"==typeof global&&global),Bn=j("object"==typeof self&&self),Ln=j("object"==typeof this&&this),Fn=Pn||Bn||Ln||Function("return this")(),En=G();(Bn||{})._=En,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return En}):On?((On.exports=En)._=En,jn._=En):Fn._=En}.call(this),function(t){"use strict";function e(t){var e=t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display;"none"!=e?t.style.display="none":t.style.display="block"}function n(e){return parseFloat(t.getElement(e).value)}function r(){var t=[],e=!0;for(var n in this.filters)t.push(this.filters[n].processor()),this.filters[n].sync===!1&&(e=!1);this.viewer.setFilterOptions({filters:{processors:t},loadMode:e?"sync":"async"})}if(!t.version||t.version.major<2)throw new Error("This version of OpenSeadragonImagefilters requires OpenSeadragon version 2.0.0+");var i=Caman;i.Store.put=function(){},t.Viewer.prototype.imagefilters=function(e){return this.imageFilterInstance&&!e||(e=e||{},e.viewer=this,this.imageFilterInstance=new t.ImagefilterTools(e)),this.imageFilterInstance},t.ImagefilterTools=function(e){t.extend(!0,this,{viewer:null,buttonActiveImg:!1,showControl:!0,startOpen:!1,prefixUrl:null,toolsLeft:null,toolsTop:null,toolsWidth:180,toolsHeight:150,"class":null,navImages:{imagetools:{REST:"imagetools_rest.png",GROUP:"imagetools_grouphover.png",HOVER:"imagetools_hover.png",DOWN:"imagetools_pressed.png"}},filters:{brightness:{min:-255,max:255,processor:function(){var t=n("osd-filter-brightness");return OpenSeadragon.Filters.BRIGHTNESS(t)}},contrast:{min:0,max:5,value:1,step:.1,processor:function(){var t=n("osd-filter-contrast");return OpenSeadragon.Filters.CONTRAST(t)}}},element:null,toggleButton:null},e),t.extend(!0,this.navImages,this.viewer.navImages);var r=this.prefixUrl||this.viewer.prefixUrl||"",i=this.viewer.buttons&&this.viewer.buttons.buttons;this.showControl&&(this.toggleButton=new t.Button({element:this.toggleButton?t.getElement(this.toggleButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:t.getString("Tooltips.ImageTools")||"Image tools",srcRest:r+this.navImages.imagetools.REST,srcGroup:r+this.navImages.imagetools.GROUP,srcHover:r+this.navImages.imagetools.HOVER,srcDown:r+this.navImages.imagetools.DOWN,onRelease:this.openTools.bind(this)}),i&&(this.viewer.buttons.buttons.push(this.toggleButton),this.viewer.buttons.element.appendChild(this.toggleButton.element)),this.toggleButton.imgDown&&(this.buttonActiveImg=this.toggleButton.imgDown.cloneNode(!0),this.toggleButton.element.appendChild(this.buttonActiveImg))),this.viewer.addHandler("open",function(){this.createPopupDiv()}.bind(this)),this.startOpen&&this.viewer.addHandler("open",function(){this.openTools()}.bind(this))},t.extend(t.ImagefilterTools.prototype,t.ControlDock.prototype,{createPopupDiv:function(){var e=t.getElement("osd-imagetools");if(!e){var n=this.toolsWidth,r=this.toolsHeight,i=t.getElement(this.viewer.id),o=i.getBoundingClientRect(),a=o.height/2-r/2,u=10;e=document.createElement("div"),e.id="osd-imagetools",this["class"]?e["class"]=this["class"]:e.style="display: none; text-align:center; position:absolute;border: 1px solid black; background-color: white; width: "+n+"px; height: "+r+"px; top: "+a+"px; left: "+u+"px;",this.viewer.addControl(e,{}),e.style.display="none";for(var s in this.filters){var c=this.filters[s],h=document.createElement("input");h.type="range",h.min=c.min,h.max=c.max,h.step=c.step||1,h.value=c.value||0,h.id="osd-filter-"+s,this.onRangeChange(h);var l=document.createElement("p");l.style="margin:0;",l.innerHTML=t.getString("Tool."+s)||s,e.appendChild(l),e.appendChild(h)}var f=document.createElement("button");f.innerHTML=t.getString("Tool.reset")||"reset",f.style="display:block; margin: 0 auto; padding: 2px;",f.addEventListener("click",function(){this.resetFilters()}.bind(this)),e.appendChild(f)}},openTools:function(){var n=t.getElement("osd-imagetools");e(n)},updateFilters:_.debounce(r,50),resetFilters:function(){for(var e in this.filters){var n=t.getElement("osd-filter-"+e);n.value=this.filters[e].value||0}this.updateFilters()},onRangeChange:function(t,e){t.addEventListener("input",function(t){this.updateFilters()}.bind(this))}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonimagefilter.js.map
